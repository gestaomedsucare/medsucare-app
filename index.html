<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedSuCare - Sistema de Gest√£o Empresarial</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #0891b2 0%, #0e7490 50%, #164e63 100%); }
        .sidebar-item:hover { background: rgba(255,255,255,0.1); }
        .sidebar-item.active { background: rgba(255,255,255,0.2); border-left: 4px solid #fff; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); }
        @media print { .no-print { display: none !important; } }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .tab-btn { transition: all 0.2s; }
        .tab-btn:hover { background: rgba(6, 182, 212, 0.05); }
        .tab-content { animation: fadeIn 0.2s ease-in-out; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .sync-btn { transition: all 0.3s; }
        .sync-btn:hover { transform: scale(1.02); }
        .sync-btn:active { transform: scale(0.98); }
        .file-drop { border: 2px dashed #cbd5e1; transition: all 0.3s; }
        .file-drop:hover, .file-drop.dragover { border-color: #06b6d4; background: rgba(6, 182, 212, 0.05); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
        .status-dot.green { background: #22c55e; }
        .status-dot.yellow { background: #eab308; }
        .status-dot.red { background: #ef4444; }
        .loading-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- TELA DE LOGIN -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center gradient-bg">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4 fade-in">
            <div class="text-center mb-6">
                <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-cyan-100 mb-4">
                    <span class="text-4xl">üè•</span>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">MedSuCare</h1>
                <p class="text-gray-500 text-sm">Sistema de Gest√£o Empresarial</p>
                <div class="mt-2 inline-flex items-center gap-2 px-3 py-1 bg-yellow-100 rounded-full text-xs text-yellow-700">
                    <span class="status-dot yellow"></span>
                    Modo Offline - Sincronize com Google Drive
                </div>
            </div>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
                    <input type="email" id="loginEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent" placeholder="seu@email.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Senha</label>
                    <input type="password" id="loginPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button type="submit" class="w-full py-3 bg-cyan-600 hover:bg-cyan-700 text-white font-semibold rounded-lg transition duration-200">
                    Entrar
                </button>
            </form>
            <div id="loginError" class="mt-4 p-3 bg-red-100 text-red-700 rounded-lg text-sm hidden"></div>
            <div class="mt-6 text-center">
                <button onclick="showRegister()" class="text-cyan-600 hover:text-cyan-700 text-sm font-medium">
                    Solicitar acesso ao Administrador
                </button>
            </div>
            <div class="mt-4 p-4 bg-blue-50 rounded-lg text-xs text-blue-700">
                <strong>üí° Sincroniza√ß√£o:</strong> Clique em "Backup" para exportar/importar dados do Google Drive
            </div>
        </div>
    </div>

    <!-- TELA DE REGISTRO -->
    <div id="registerScreen" class="min-h-screen flex items-center justify-center gradient-bg hidden">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4 fade-in">
            <div class="text-center mb-6">
                <h2 class="text-xl font-bold text-gray-800">Solicitar Acesso</h2>
                <p class="text-gray-500 text-sm">Preencha para solicitar acesso ao sistema</p>
            </div>
            <form id="registerForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nome Completo</label>
                    <input type="text" id="regName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="Seu nome completo">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
                    <input type="email" id="regEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="seu@email.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Cargo/Fun√ß√£o</label>
                    <select id="regRole" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500">
                        <option value="CEO">CEO - Propriet√°rio</option>
                        <option value="VENDEDOR">Vendedor</option>
                        <option value="COMPRADOR">Comprador</option>
                        <option value="PRODUCAO">Chefe de Produ√ß√£o</option>
                        <option value="CONTADOR">Contador</option>
                        <option value="CORTADOR">Cortador</option>
                        <option value="COSTUREIRA">Costureira</option>
                        <option value="EMBALADOR">Embalador</option>
                        <option value="TRANSPORTADOR">Transportador</option>
                        <option value="DESIGNER">Designer</option>
                        <option value="ADMIN">Administrador</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Departamento</label>
                    <select id="regDepartamento" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500">
                        <option value="Administrativo">Administrativo</option>
                        <option value="Comercial">Comercial</option>
                        <option value="Produ√ß√£o">Produ√ß√£o</option>
                        <option value="Financeiro">Financeiro</option>
                        <option value="TI">Tecnologia da Informa√ß√£o</option>
                    </select>
                </div>
                <button type="submit" class="w-full py-3 bg-cyan-600 hover:bg-cyan-700 text-white font-semibold rounded-lg">
                    Solicitar Acesso
                </button>
            </form>
            <div id="registerSuccess" class="mt-4 p-3 bg-green-100 text-green-700 rounded-lg text-sm hidden"></div>
            <button onclick="showLogin()" class="mt-4 w-full py-2 text-gray-600 hover:text-gray-800">
                ‚Üê Voltar ao Login
            </button>
        </div>
    </div>

    <!-- APLICATIVO PRINCIPAL -->
    <div id="appScreen" class="hidden min-h-screen flex">
        <!-- BOT√ÉO MENU MOBILE -->
        <button onclick="toggleMobileMenu()" class="fixed top-4 left-4 z-50 bg-cyan-600 text-white p-2 rounded-lg md:hidden">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </button>

        <!-- SIDEBAR -->
        <aside id="sidebar" class="w-64 gradient-bg text-white flex flex-col fixed h-full z-50 no-print md:relative">
            <div class="p-4 border-b border-white/20">
                <div class="flex items-center gap-3">
                    <span class="text-3xl" id="sidebarLogo">üè•</span>
                    <div>
                        <h1 class="font-bold text-lg">MedSuCare</h1>
                        <p class="text-xs text-cyan-200">Gest√£o Empresarial</p>
                    </div>
                </div>
            </div>
            <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
                <button onclick="showSection('dashboard')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3" id="nav-dashboard">
                    <span>üìä</span> <span>Dashboard</span>
                </button>
                <button onclick="showSection('os')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3" id="nav-os">
                    <span>üìã</span> <span>Ordens de Servi√ßo</span>
                </button>
                <button onclick="showSection('clientes')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3" id="nav-clientes">
                    <span>üë•</span> <span>Clientes</span>
                </button>
                <button onclick="showSection('fornecedores')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3" id="nav-fornecedores">
                    <span>üöö</span> <span>Fornecedores</span>
                </button>
                <button onclick="showSection('produtos')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3" id="nav-produtos">
                    <span>üì¶</span> <span>Cat√°logo</span>
                </button>
                <button onclick="showSection('producao')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3" id="nav-producao">
                    <span>‚öôÔ∏è</span> <span>Produ√ß√£o</span>
                </button>
                <button onclick="showSection('estoque')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3" id="nav-estoque">
                    <span>üìà</span> <span>Estoque</span>
                </button>
                <button onclick="showSection('vendas')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3" id="nav-vendas">
                    <span>üí∞</span> <span>Vendas</span>
                </button>
                <button onclick="showSection('compras')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3" id="nav-compras">
                    <span>üõí</span> <span>Compras</span>
                </button>
                <button onclick="showSection('financeiro')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3" id="nav-financeiro">
                    <span>üí≥</span> <span>Financeiro</span>
                </button>
                <button onclick="showSection('relatorios')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3" id="nav-relatorios">
                    <span>üìë</span> <span>Relat√≥rios</span>
                </button>
                <div id="adminMenu" class="hidden pt-4 border-t border-white/20 mt-4">
                    <p class="px-4 text-xs text-cyan-200 uppercase mb-2">Administra√ß√£o</p>
                    <button onclick="showSection('usuarios')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3" id="nav-usuarios">
                        <span>üë§</span> <span>Usu√°rios</span>
                    </button>
                    <button onclick="showSection('empresa')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3" id="nav-empresa">
                        <span>üè¢</span> <span>Empresa</span>
                    </button>
                    <button onclick="showSection('backup')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3" id="nav-backup">
                        <span>üíæ</span> <span>Backup/Sync</span>
                    </button>
                </div>
            </nav>
            <div class="p-4 border-t border-white/20">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-full bg-cyan-600 flex items-center justify-center font-semibold" id="userInitial">U</div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium truncate" id="userName">Usu√°rio</p>
                        <p class="text-xs text-cyan-200 truncate" id="userRole">Cargo</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="logout()" class="flex-1 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-sm transition">
                        üö™ Sair
                    </button>
                </div>
            </div>
        </aside>

        <!-- CONTE√öDO PRINCIPAL -->
        <main class="flex-1 ml-0 md:ml-64 p-4 md:p-6 w-full">
            <!-- BARRA DE STATUS DE SINCRONIZA√á√ÉO -->
            <div id="syncStatusBar" class="hidden bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4 flex flex-col sm:flex-row items-center gap-3">
                <div class="flex items-center gap-2">
                    <span class="status-dot yellow"></span>
                    <span class="text-sm text-yellow-800 font-medium">‚ö†Ô∏è Dados Locais - Sincronize com Google Drive</span>
                </div>
                <div class="flex gap-2 sm:ml-auto">
                    <a href="https://drive.google.com/drive/folders/1nCGxnIR1tEc92dZvoBEU9K1kOiTa1KXH?usp=sharing" target="_blank" class="px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700">
                        üìÇ Abrir Pasta do Drive
                    </a>
                    <button onclick="showSection('backup')" class="px-3 py-1 bg-cyan-600 text-white rounded text-xs hover:bg-cyan-700">
                        üîÑ Sincronizar Agora
                    </button>
                </div>
            </div>

            <!-- DASHBOARD -->
            <section id="dashboard" class="section fade-in hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üìä Dashboard</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-6 md:mb-8">
                    <div class="bg-white rounded-xl p-4 md:p-6 shadow-sm card-hover transition">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">OS em Aberto</p>
                                <p class="text-2xl md:text-3xl font-bold text-cyan-600" id="statOS">0</p>
                            </div>
                            <div class="w-10 h-10 md:w-12 md:h-12 bg-cyan-100 rounded-full flex items-center justify-center text-xl md:text-2xl">üìã</div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl p-4 md:p-6 shadow-sm card-hover transition">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">Clientes Ativos</p>
                                <p class="text-2xl md:text-3xl font-bold text-green-600" id="statClientes">0</p>
                            </div>
                            <div class="w-10 h-10 md:w-12 md:h-12 bg-green-100 rounded-full flex items-center justify-center text-xl md:text-2xl">üë•</div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl p-4 md:p-6 shadow-sm card-hover transition">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">Pedidos M√™s</p>
                                <p class="text-2xl md:text-3xl font-bold text-purple-600" id="statPedidos">0</p>
                            </div>
                            <div class="w-10 h-10 md:w-12 md:h-12 bg-purple-100 rounded-full flex items-center justify-center text-xl md:text-2xl">üì¶</div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl p-4 md:p-6 shadow-sm card-hover transition">
                        <div class="flex items-center justify-between>
                                <p">
                            <div class="text-gray-500 text-sm">Faturamento</p>
                                <p class="text-2xl md:text-3xl font-bold text-orange-600" id="statFaturamento">R$ 0</p>
                            </div>
                            <div class="w-10 h-10 md:w-12 md:h-12 bg-orange-100 rounded-full flex items-center justify-center text-xl md:text-2xl">üí∞</div>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
                    <div class="bg-white rounded-xl p-4 md:p-6 shadow-sm">
                        <h3 class="font-semibold text-gray-800 mb-4">üìã √öltimas Ordens de Servi√ßo</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-3 py-2 text-left">OS</th>
                                        <th class="px-3 py-2 text-left">Cliente</th>
                                        <th class="px-3 py-2 text-left">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recentOS"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl p-4 md:p-6 shadow-sm">
                        <h3 class="font-semibold text-gray-800 mb-4">‚öôÔ∏è Produ√ß√£o em Andamento</h3>
                        <div id="producaoAndamento" class="space-y-3"></div>
                    </div>
                </div>
            </section>

            <!-- ORDENS DE SERVI√áO -->
            <section id="os" class="section hidden">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">üìã Ordens de Servi√ßo</h2>
                    <button onclick="openOSModal()" class="bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 w-full md:w-auto justify-center">
                        <span>+</span> Nova OS
                    </button>
                </div>
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="p-4 border-b flex flex-col md:flex-row gap-3">
                        <input type="text" id="searchOS" onkeyup="filterOS()" placeholder="Buscar OS..." class="px-4 py-2 border rounded-lg flex-1">
                        <select id="filterStatusOS" onchange="filterOS()" class="px-4 py-2 border rounded-lg">
                            <option value="">Todos Status</option>
                            <option value="Or√ßamento">Or√ßamento</option>
                            <option value="Pedido">Pedido</option>
                            <option value="Produ√ß√£o">Produ√ß√£o</option>
                            <option value="Entregue">Entregue</option>
                        </select>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left">OS</th>
                                    <th class="px-4 py-3 text-left">Data/Hora</th>
                                    <th class="px-4 py-3 text-left">Cliente</th>
                                    <th class="px-4 py-3 text-left">Status</th>
                                    <th class="px-4 py-3 text-left">Valor</th>
                                    <th class="px-4 py-3 text-left">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="osTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- CLIENTES -->
            <section id="clientes" class="section hidden">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">üë• Clientes</h2>
                    <button onclick="openClienteModal()" class="bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 w-full md:w-auto justify-center">
                        <span>+</span> Novo Cliente
                    </button>
                </div>
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="p-4 border-b">
                        <input type="text" id="searchClientes" onkeyup="filterClientes()" placeholder="Buscar clientes..." class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left">C√≥digo</th>
                                    <th class="px-4 py-3 text-left">Empresa</th>
                                    <th class="px-4 py-3 text-left">Contato</th>
                                    <th class="px-4 py-3 text-left">Status</th>
                                    <th class="px-4 py-3 text-left">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="clientesTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- FORNECEDORES -->
            <section id="fornecedores" class="section hidden">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">üöö Fornecedores</h2>
                    <button onclick="openFornecedorModal()" class="bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 w-full md:w-auto justify-center">
                        <span>+</span> Novo Fornecedor
                    </button>
                </div>
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="p-4 border-b">
                        <input type="text" id="searchFornecedores" onkeyup="filterFornecedores()" placeholder="Buscar fornecedores..." class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <table class="w-full text-sm">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left">C√≥digo</th>
                                <th class="px-4 py-3 text-left">Nome</th>
                                <th class="px-4 py-3 text-left">CNPJ</th>
                                <th class="px-4 py-3 text-left">Produtos</th>
                                <th class="px-4 py-3 text-left">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="fornecedoresTableBody"></tbody>
                    </table>
                </div>
            </section>

            <!-- PRODUTOS -->
            <section id="produtos" class="section hidden">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">üì¶ Cat√°logo de Produtos</h2>
                    <button onclick="openProdutoModal()" class="bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 w-full md:w-auto justify-center">
                        <span>+</span> Novo Produto
                    </button>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="produtosGrid"></div>
            </section>

            <!-- PRODU√á√ÉO -->
            <section id="producao" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">‚öôÔ∏è Controle de Produ√ß√£o</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white p-4 rounded-xl shadow-sm">
                        <h4 class="font-semibold text-gray-600 mb-2">üìè Etapa 1 - Corte</h4>
                        <p class="text-2xl font-bold text-cyan-600" id="prodCorte">0</p>
                        <p class="text-xs text-gray-500">Em andamento</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm">
                        <h4 class="font-semibold text-gray-600 mb-2">üßµ Etapa 2 - Costura</h4>
                        <p class="text-2xl font-bold text-purple-600" id="prodCostura">0</p>
                        <p class="text-xs text-gray-500">Em andamento</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm">
                        <h4 class="font-semibold text-gray-600 mb-2">üì¶ Etapa 3 - Embalagem</h4>
                        <p class="text-2xl font-bold text-green-600" id="prodEmbalagem">0</p>
                        <p class="text-xs text-gray-500">Em andamento</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm">
                        <h4 class="font-semibold text-gray-600 mb-2">üöö Etapa 4 - Entrega</h4>
                        <p class="text-2xl font-bold text-orange-600" id="prodEntrega">0</p>
                        <p class="text-xs text-gray-500">A entregar</p>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="p-4 border-b">
                        <select id="filterEtapaProducao" onchange="filterProducao()" class="px-4 py-2 border rounded-lg w-full">
                            <option value="">Todas as Etapas</option>
                            <option value="corte">Corte</option>
                            <option value="costura">Costura</option>
                            <option value="embalagem">Embalagem</option>
                            <option value="entrega">Entrega</option>
                        </select>
                    </div>
                    <table class="w-full text-sm">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left">OS</th>
                                <th class="px-4 py-3 text-left">Cliente</th>
                                <th class="px-4 py-3 text-left">Quantidade</th>
                                <th class="px-4 py-3 text-left">Etapa</th>
                                <th class="px-4 py-3 text-left">Respons√°vel</th>
                                <th class="px-4 py-3 text-left">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="producaoTableBody"></tbody>
                    </table>
                </div>
            </section>

            <!-- ESTOQUE -->
            <section id="estoque" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üìà Controle de Estoque</h2>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                    <div class="bg-white p-4 rounded-xl shadow-sm">
                        <h4 class="font-semibold text-gray-600">Tecidos (TNT)</h4>
                        <p class="text-2xl font-bold text-cyan-600" id="estoqueTecidos">0</p>
                        <p class="text-xs text-gray-500">metros</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm">
                        <h4 class="font-semibold text-gray-600">Aviamentos</h4>
                        <p class="text-2xl font-bold text-purple-600" id="estoqueAviamentos">0</p>
                        <p class="text-xs text-gray-500">itens</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm">
                        <h4 class="font-semibold text-gray-600">Embalagens</h4>
                        <p class="text-2xl font-bold text-green-600" id="estoqueEmbalagens">0</p>
                        <p class="text-xs text-gray-500">unidades</p>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="p-4 border-b flex flex-col md:flex-row justify-between items-center gap-3">
                        <input type="text" id="searchEstoque" onkeyup="filterEstoque()" placeholder="Buscar item..." class="px-4 py-2 border rounded-lg flex-1 w-full">
                        <button onclick="openEstoqueModal()" class="bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 w-full md:w-auto justify-center">
                            <span>+</span> Novo Item
                        </button>
                    </div>
                    <table class="w-full text-sm">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left">Item</th>
                                <th class="px-4 py-3 text-left">Tipo</th>
                                <th class="px-4 py-3 text-left">Quantidade</th>
                                <th class="px-4 py-3 text-left">M√≠n/M√°x</th>
                                <th class="px-4 py-3 text-left">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="estoqueTableBody"></tbody>
                    </table>
                </div>
            </section>

            <!-- VENDAS -->
            <section id="vendas" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üí∞ Vendas</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
                    <div class="bg-white rounded-xl shadow-sm p-4 md:p-6">
                        <h3 class="font-semibold text-gray-800 mb-4">üìä Resumo de Vendas</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Or√ßamentos Aprovados</span>
                                <span class="font-bold text-green-600" id="vendasOrcamentos">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Pedidos em Andamento</span>
                                <span class="font-bold text-cyan-600" id="vendasPedidos">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Vendas Finalizadas (M√™s)</span>
                                <span class="font-bold text-purple-600" id="vendasFinalizadas">0</span>
                            </div>
                            <div class="border-t pt-4">
                                <div class="flex justify-between">
                                    <span class="text-gray-800 font-semibold">Total Faturado (M√™s)</span>
                                    <span class="font-bold text-2xl text-green-600" id="vendasTotal">R$ 0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-4 md:p-6">
                        <h3 class="font-semibold text-gray-800 mb-4">üìà Vendas por M√™s</h3>
                        <div id="chartVendas" class="h-48 flex items-end justify-around gap-2"></div>
                    </div>
                </div>
            </section>

            <!-- COMPRAS -->
            <section id="compras" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üõí Compras</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
                    <div class="bg-white rounded-xl shadow-sm p-4 md:p-6">
                        <h3 class="font-semibold text-gray-800 mb-4">üìã Nova Solicita√ß√£o de Compra</h3>
                        <form id="compraForm" class="space-y-4">
                            <div>
                                <label class="block text-sm text-gray-600 mb-1">Fornecedor</label>
                                <select id="compraFornecedor" class="w-full px-4 py-2 border rounded-lg" required></select>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 mb-1">Mat√©ria Prima</label>
                                <select id="compraMaterial" class="w-full px-4 py-2 border rounded-lg" required>
                                    <option value="TNT Polipropileno">TNT Polipropileno</option>
                                    <option value="TNT SMS">TNT SMS</option>
                                    <option value="TNT SMMS">TNT SMMS</option>
                                    <option value="TNT SSMMSS">TNT SSMMSS</option>
                                    <option value="El√°stico">El√°stico</option>
                                    <option value="Z√≠per">Z√≠per</option>
                                    <option value="Linha de Costura">Linha de Costura</option>
                                    <option value="Embalagem">Embalagem</option>
                                    <option value="Etiqueta">Etiqueta</option>
                                    <option value="Velcro">Velcro</option>
                                </select>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Quantidade</label>
                                    <input type="number" id="compraQuantidade" class="w-full px-4 py-2 border rounded-lg" required>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Valor Unit√°rio (R$)</label>
                                    <input type="number" id="compraValor" step="0.01" class="w-full px-4 py-2 border rounded-lg" required>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 mb-1">Observa√ß√µes</label>
                                <textarea id="compraObs" class="w-full px-4 py-2 border rounded-lg" rows="2" placeholder="Informa√ß√µes adicionais..."></textarea>
                            </div>
                            <button type="submit" class="w-full py-3 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-semibold">
                                Solicitar Compra
                            </button>
                        </form>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-4 md:p-6">
                        <h3 class="font-semibold text-gray-800 mb-4">üìú √öltimas Compras</h3>
                        <div id="comprasList" class="space-y-3 max-h-96 overflow-y-auto"></div>
                    </div>
                </div>
            </section>

            <!-- FINANCEIRO -->
            <section id="financeiro" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üí≥ Financeiro</h2>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                    <div class="bg-white p-4 rounded-xl shadow-sm">
                        <h4 class="font-semibold text-gray-600 mb-2">üíµ A Receber</h4>
                        <p class="text-2xl font-bold text-green-600" id="finReceber">R$ 0</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm">
                        <h4 class="font-semibold text-gray-600 mb-2">üí∏ A Pagar</h4>
                        <p class="text-2xl font-bold text-red-600" id="finPagar">R$ 0</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm">
                        <h4 class="font-semibold text-gray-600 mb-2">üìä Saldo</h4>
                        <p class="text-2xl font-bold text-cyan-600" id="finSaldo">R$ 0</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
                    <div class="bg-white rounded-xl shadow-sm p-4 md:p-6">
                        <h3 class="font-semibold text-gray-800 mb-4">üì• Contas a Receber</h3>
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-3 py-2 text-left">Cliente</th>
                                    <th class="px-3 py-2 text-left">Vencimento</th>
                                    <th class="px-3 py-2 text-left">Valor</th>
                                    <th class="px-3 py-2 text-left">Status</th>
                                </tr>
                            </thead>
                            <tbody id="contasReceber"></tbody>
                        </table>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-4 md:p-6">
                        <h3 class="font-semibold text-gray-800 mb-4">üì§ Contas a Pagar</h3>
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-3 py-2 text-left">Fornecedor</th>
                                    <th class="px-3 py-2 text-left">Vencimento</th>
                                    <th class="px-3 py-2 text-left">Valor</th>
                                    <th class="px-3 py-2 text-left">Status</th>
                                </tr>
                            </thead>
                            <tbody id="contasPagar"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- RELAT√ìRIOS -->
            <section id="relatorios" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üìë Relat√≥rios</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="bg-white rounded-xl shadow-sm p-6 card-hover cursor-pointer" onclick="generateReport('vendas')">
                        <div class="text-4xl mb-4">üìà</div>
                        <h3 class="font-semibold text-gray-800">Relat√≥rio de Vendas</h3>
                        <p class="text-sm text-gray-500 mt-2">Per√≠odo, clientes, produtos e valores</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-6 card-hover cursor-pointer" onclick="generateReport('producao')">
                        <div class="text-4xl mb-4">‚öôÔ∏è</div>
                        <h3 class="font-semibold text-gray-800">Relat√≥rio de Produ√ß√£o</h3>
                        <p class="text-sm text-gray-500 mt-2">Etapas, efici√™ncia e prazos</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-6 card-hover cursor-pointer" onclick="generateReport('financeiro')">
                        <div class="text-4xl mb-4">üí∞</div>
                        <h3 class="font-semibold text-gray-800">Relat√≥rio Financeiro</h3>
                        <p class="text-sm text-gray-500 mt-2">Receitas, despesas e fluxo de caixa</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-6 card-hover cursor-pointer" onclick="generateReport('estoque')">
                        <div class="text-4xl mb-4">üì¶</div>
                        <h3 class="font-semibold text-gray-800">Relat√≥rio de Estoque</h3>
                        <p class="text-sm text-gray-500 mt-2">Mat√©ria prima e produtos acabados</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-6 card-hover cursor-pointer" onclick="generateReport('compras')">
                        <div class="text-4xl mb-4">üõí</div>
                        <h3 class="font-semibold text-gray-800">Relat√≥rio de Compras</h3>
                        <p class="text-sm text-gray-500 mt-2">Fornecedores e aquisi√ß√µes</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-6 card-hover cursor-pointer" onclick="generateReport('os')">
                        <div class="text-4xl mb-4">üìã</div>
                        <h3 class="font-semibold text-gray-800">Relat√≥rio de OS</h3>
                        <p class="text-sm text-gray-500 mt-2">Ordens de servi√ßo por per√≠odo</p>
                    </div>
                </div>
            </section>

            <!-- USU√ÅRIOS (ADMIN) -->
            <section id="usuarios" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üë§ Gerenciamento de Usu√°rios</h2>
                <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                    <h3 class="font-semibold text-gray-800 mb-4">üìã Solicita√ß√µes de Acesso Pendentes</h3>
                    <div id="pendingUsers" class="space-y-2"></div>
                </div>
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="p-4 border-b">
                        <h3 class="font-semibold text-gray-800">üë• Usu√°rios Cadastrados</h3>
                    </div>
                    <table class="w-full text-sm">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left">Nome</th>
                                <th class="px-4 py-3 text-left">E-mail</th>
                                <th class="px-4 py-3 text-left">Cargo</th>
                                <th class="px-4 py-3 text-left">Departamento</th>
                                <th class="px-4 py-3 text-left">Acesso</th>
                                <th class="px-4 py-3 text-left">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody"></tbody>
                    </table>
                </div>
            </section>

            <!-- EMPRESA (ADMIN) -->
            <section id="empresa" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üè¢ Configura√ß√µes da Empresa</h2>
                
                <!-- Abas de Configura√ß√£o -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="tabs-container overflow-x-auto flex gap-2 p-4 border-b bg-gray-50">
                        <button class="tab-button active px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition" data-tab="tab-dados" onclick="switchTab('tab-dados')">üìã Dados da Empresa</button>
                        <button class="tab-button px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition" data-tab="tab-admin" onclick="switchTab('tab-admin')">üîê Administrador</button>
                        <button class="tab-button px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition" data-tab="tab-bancos" onclick="switchTab('tab-bancos')">üè¶ Bancos</button>
                        <button class="tab-button px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition" data-tab="tab-logo" onclick="switchTab('tab-logo')">üñºÔ∏è Logotipo</button>
                        <button class="tab-button px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition" data-tab="tab-diversos" onclick="switchTab('tab-diversos')">üìù Diversos</button>
                    </div>
                    
                    <!-- Tab: Dados da Empresa -->
                    <div id="tab-dados" class="tab-pane active p-4 md:p-6">
                        <form id="empresaForm" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <div class="lg:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Raz√£o Social *</label>
                                    <input type="text" id="empRazao" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="Nome oficial da empresa">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Nome Fantasia</label>
                                    <input type="text" id="empNome" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="Nome de exibi√ß√£o">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Abreviatura (para relat√≥rios)</label>
                                    <input type="text" id="empAbrev" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="Ex: MedSuCare">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">CNPJ</label>
                                    <input type="text" id="empCNPJ" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="00.000.000/0000-00">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Inscri√ß√£o Estadual</label>
                                    <input type="text" id="empIE" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="Isento ou n√∫mero">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Inscri√ß√£o Municipal</label>
                                    <input type="text" id="empIM" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="N√∫mero da Inscri√ß√£o Municipal">
                                </div>
                                <div class="lg:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Endere√ßo Completo</label>
                                    <input type="text" id="empEndereco" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="Rua, n√∫mero, complemento, bairro">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">CEP</label>
                                    <input type="text" id="empCEP" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="00000-000">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Cidade/UF</label>
                                    <input type="text" id="empCidade" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="Cidade - UF">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Pa√≠s</label>
                                    <input type="text" id="empPais" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" value="Brasil">
                                </div>
                            </div>
                            
                            <div class="border-t pt-4 mt-4">
                                <h4 class="font-semibold text-gray-700 mb-3">üìû Contatos</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Telefone Fixo</label>
                                        <input type="text" id="empTelefone" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="(00) 0000-0000">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Celular/WApp</label>
                                        <input type="text" id="empCelular" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="(00) 00000-0000">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">E-mail Principal</label>
                                        <input type="email" id="empEmail" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="contato@empresa.com">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Site</label>
                                        <input type="url" id="empSite" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="https://www.empresa.com.br">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="border-t pt-4 mt-4">
                                <h4 class="font-semibold text-gray-700 mb-3">üë§ Respons√°vel Legal</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Nome do Respons√°vel</label>
                                        <input type="text" id="empResponsavel" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="Nome completo">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">CPF</label>
                                        <input type="text" id="empRespCPF" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="000.000.000-00">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Cargo/Fun√ß√£o</label>
                                        <input type="text" id="empRespCargo" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="Ex: Propriet√°rio, Diretor">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex gap-3 pt-4">
                                <button type="submit" class="flex-1 py-3 bg-cyan-600 hover:bg-cyan-700 text-white font-semibold rounded-lg transition">
                                    üíæ Salvar Dados da Empresa
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Tab: Administrador -->
                    <div id="tab-admin" class="tab-pane p-4 md:p-6">
                        <form id="adminForm" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">E-mail do Administrador *</label>
                                    <input type="email" id="adminEmail" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="seu@email.com">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Nome Completo *</label>
                                    <input type="text" id="adminNome" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="Seu nome completo">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Cargo/Fun√ß√£o</label>
                                    <input type="text" id="adminCargo" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="Ex: Propriet√°rio, Administrador">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
                                    <input type="text" id="adminTelefone" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="(00) 00000-0000">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Nova Senha</label>
                                    <input type="password" id="adminSenha" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="Deixe vazio para manter a atual">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Confirmar Nova Senha</label>
                                    <input type="password" id="adminSenhaConfirm" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="Confirme a nova senha">
                                </div>
                            </div>
                            <div class="flex gap-3 pt-4 border-t">
                                <button type="submit" class="flex-1 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition">
                                    üîê Atualizar Administrador
                                </button>
                            </div>
                        </form>
                        
                        <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                            <h4 class="font-semibold text-gray-700 mb-2">üìä Informa√ß√µes da Conta</h4>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-500">Conta criada em:</span>
                                    <p class="font-medium" id="adminCriado">-</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">√öltimo acesso:</span>
                                    <p class="font-medium" id="adminUltimoAcesso">-</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">Total de acessos:</span>
                                    <p class="font-medium" id="adminTotalAcessos">-</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tab: Bancos -->
                    <div id="tab-bancos" class="tab-pane p-4 md:p-6">
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="font-semibold text-gray-800 mb-4">üè¶ Contas Banc√°rias da Empresa</h3>
                            
                            <form id="bancoForm" class="space-y-4 mb-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Nome do Banco *</label>
                                        <input type="text" id="bancoNome" required placeholder="Ex: Banco do Brasil" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">C√≥digo do Banco</label>
                                        <input type="text" id="bancoCodigo" placeholder="Ex: 001" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Ag√™ncia *</label>
                                        <input type="text" id="bancoAgencia" required placeholder="Ex: 0000-0" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Conta Corrente *</label>
                                        <input type="text" id="bancoConta" required placeholder="Ex: 00000-0" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Conta</label>
                                        <select id="bancoTipo" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500">
                                            <option value="corrente">Conta Corrente</option>
                                            <option value="poupanca">Conta Poupan√ßa</option>
                                            <option value="pagamentos">Conta Pagamentos</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Opera√ß√£o (opcional)</label>
                                        <input type="text" id="bancoOperacao" placeholder="Ex: 013" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Chave PIX Principal</label>
                                    <input type="text" id="bancoPix" placeholder="CPF, CNPJ, E-mail, Telefone ou Chave Aleat√≥ria" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500">
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes</label>
                                        <input type="text" id="bancoObs" placeholder="Ex: Conta principal para recebimento" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                        <select id="bancoStatus" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500">
                                            <option value="ativa">Ativa</option>
                                            <option value="inativa">Inativa</option>
                                        </select>
                                    </div>
                                </div>
                                <button type="submit" class="w-full py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg">
                                    + Adicionar Conta Banc√°ria
                                </button>
                            </form>
                            
                            <div id="bancosList" class="space-y-3"></div>
                        </div>
                    </div>
                    
                    <!-- Tab: Logotipo -->
                    <div id="tab-logo" class="tab-pane p-4 md:p-6">
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="font-semibold text-gray-800 mb-4">üñºÔ∏è Logotipo da Empresa</h3>
                            <p class="text-sm text-gray-500 mb-4">O logotipo aparecer√° em todos os documentos gerados pelo sistema (or√ßamentos, OS, notas).</p>
                            
                            <div class="flex flex-col md:flex-row gap-6">
                                <div class="flex-shrink-0">
                                    <div id="logoPreviewContainer" class="w-48 h-48 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center bg-gray-50">
                                        <span class="text-6xl" id="logoPreview">üè•</span>
                                        <p class="text-sm text-gray-500 mt-2" id="logoName">Sem logotipo</p>
                                    </div>
                                </div>
                                <div class="flex-1 space-y-4">
                                    <div class="border-2 border-dashed border-cyan-200 rounded-lg p-6 text-center bg-cyan-50">
                                        <input type="file" id="logoInput" accept="image/*" class="hidden" onchange="handleLogoUpload(event)">
                                        <button onclick="document.getElementById('logoInput').click()" class="px-6 py-3 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-semibold">
                                            üìÅ Enviar Logotipo
                                        </button>
                                        <p class="text-sm text-gray-500 mt-2">Formatos aceitos: JPG, PNG, GIF (m√°x 2MB)</p>
                                    </div>
                                    
                                    <div id="logoInfo" class="hidden p-4 bg-green-50 border border-green-200 rounded-lg">
                                        <p class="text-sm text-green-700">‚úÖ Logotipo carregado com sucesso!</p>
                                        <button onclick="removeLogo()" class="text-sm text-red-600 hover:text-red-800 mt-2">Remover logotipo</button>
                                    </div>
                                    
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <h4 class="font-medium text-gray-700 mb-2">üìê Especifica√ß√µes Recomendadas</h4>
                                        <ul class="text-sm text-gray-600 space-y-1">
                                            <li>‚Ä¢ Dimens√µes: 200 x 200 pixels (m√≠nimo)</li>
                                            <li>‚Ä¢ Fundo transparente ou branco</li>
                                            <li>‚Ä¢ Formato quadrado ou retangular</li>
                                            <li>‚Ä¢ Arquivo de no m√°ximo 2MB</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tab: Diversos -->
                    <div id="tab-diversos" class="tab-pane p-4 md:p-6">
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <form id="diversosForm" class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">C√≥digo CNAE Principal</label>
                                        <input type="text" id="divCNAE" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="Ex: 1413-4/01">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">NIRE (Registro Junta Comercial)</label>
                                        <input type="text" id="divNIRE" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="N√∫mero NIRE">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Indicador de IE</label>
                                        <select id="divIndicadorIE" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500">
                                            <option value="">Selecione...</option>
                                            <option value="contribuinte">Contribuinte ICMs</option>
                                            <option value="nao_contribuinte">N√£o Contribuinte</option>
                                            <option value="isento">Isento</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Regime Tribut√°rio</label>
                                        <select id="divRegime" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500">
                                            <option value="">Selecione...</option>
                                            <option value="simples">Simples Nacional</option>
                                            <option value="presumido">Lucro Presumido</option>
                                            <option value="real">Lucro Real</option>
                                            <option value="mei">MEI</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="border-t pt-4 mt-4">
                                    <h4 class="font-semibold text-gray-700 mb-3">üì± Redes Sociais (opcional)</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Facebook</label>
                                            <input type="url" id="divFacebook" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="https://facebook.com/...">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Instagram</label>
                                            <input type="text" id="divInstagram" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="@empresa">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">LinkedIn</label>
                                            <input type="url" id="divLinkedin" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500" placeholder="https://linkedin.com/...">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="border-t pt-4 mt-4">
                                    <h4 class="font-semibold text-gray-700 mb-3">üìÑ Dados Adicionais para Documentos</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Texto Rodap√© Or√ßamento</label>
                                            <textarea id="divRodapeOrcamento" class="w-full px-4 py-2 border rounded-lg" rows="3" placeholder="Informa√ß√µes que aparecer√£o no rodap√© dos or√ßamentos..."></textarea>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes Padr√£o OS</label>
                                            <textarea id="divObsOS" class="w-full px-4 py-2 border rounded-lg" rows="3" placeholder="Observa√ß√µes padr√£o para Ordens de Servi√ßo..."></textarea>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex gap-3 pt-4">
                                    <button type="submit" class="flex-1 py-3 bg-cyan-600 hover:bg-cyan-700 text-white font-semibold rounded-lg transition">
                                        üíæ Salvar Configura√ß√µes
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </section>

            <!-- BACKUP / SINCRONIZA√á√ÉO -->
            <section id="backup" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üíæ Backup e Sincroniza√ß√£o</h2>
                
                <!-- Status de Sincroniza√ß√£o -->
                <div class="bg-cyan-50 border border-cyan-200 rounded-xl p-4 mb-6">
                    <div class="flex items-center gap-3 mb-3">
                        <span class="text-2xl">üîÑ</span>
                        <div>
                            <h3 class="font-semibold text-cyan-800">Pasta do Google Drive</h3>
                            <p class="text-sm text-cyan-600">https://drive.google.com/drive/folders/1nCGxnIR1tEc92dZvoBEU9K1kOiTa1KXH</p>
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-4 text-sm">
                        <span class="px-3 py-1 bg-cyan-100 rounded-full text-cyan-700">üìÅ Usu√°rios</span>
                        <span class="px-3 py-1 bg-cyan-100 rounded-full text-cyan-700">üìÅ Clientes</span>
                        <span class="px-3 py-1 bg-cyan-100 rounded-full text-cyan-700">üìÅ Fornecedores</span>
                        <span class="px-3 py-1 bg-cyan-100 rounded-full text-cyan-700">üìÅ Produtos</span>
                        <span class="px-3 py-1 bg-cyan-100 rounded-full text-cyan-700">üìÅ OS</span>
                        <span class="px-3 py-1 bg-cyan-100 rounded-full text-cyan-700">üìÅ Produ√ß√£o</span>
                        <span class="px-3 py-1 bg-cyan-100 rounded-full text-cyan-700">üìÅ Estoque</span>
                        <span class="px-3 py-1 bg-cyan-100 rounded-full text-cyan-700">üìÅ Compras</span>
                        <span class="px-3 py-1 bg-cyan-100 rounded-full text-cyan-700">üìÅ Empresa</span>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                    <!-- EXPORTAR (Salvar no Drive) -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="font-semibold text-gray-800 mb-4">üì§ Exportar Dados (Salvar no Computador)</h3>
                        <p class="text-sm text-gray-500 mb-4">Baixe os arquivos CSV do sistema para salvar no Google Drive.</p>
                        
                        <div class="space-y-3">
                            <button onclick="exportAllToCSV()" class="w-full py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold flex items-center justify-center gap-2 transition sync-btn">
                                üì• Baixar TODOS os Arquivos CSV
                            </button>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="exportSingleCSV('usuarios')" class="py-2 px-3 bg-gray-100 hover:bg-gray-200 rounded text-sm transition">üë§ Usu√°rios</button>
                                <button onclick="exportSingleCSV('clientes')" class="py-2 px-3 bg-gray-100 hover:bg-gray-200 rounded text-sm transition">üë• Clientes</button>
                                <button onclick="exportSingleCSV('fornecedores')" class="py-2 px-3 bg-gray-100 hover:bg-gray-200 rounded text-sm transition">üöö Fornecedores</button>
                                <button onclick="exportSingleCSV('produtos')" class="py-2 px-3 bg-gray-100 hover:bg-gray-200 rounded text-sm transition">üì¶ Produtos</button>
                                <button onclick="exportSingleCSV('os')" class="py-2 px-3 bg-gray-100 hover:bg-gray-200 rounded text-sm transition">üìã OS</button>
                                <button onclick="exportSingleCSV('producao')" class="py-2 px-3 bg-gray-100 hover:bg-gray-200 rounded text-sm transition">‚öôÔ∏è Produ√ß√£o</button>
                                <button onclick="exportSingleCSV('estoque')" class="py-2 px-3 bg-gray-100 hover:bg-gray-200 rounded text-sm transition">üìà Estoque</button>
                                <button onclick="exportSingleCSV('compras')" class="py-2 px-3 bg-gray-100 hover:bg-gray-200 rounded text-sm transition">üõí Compras</button>
                                <button onclick="exportSingleCSV('empresa')" class="py-2 px-3 bg-gray-100 hover:bg-gray-200 rounded text-sm transition">üè¢ Empresa</button>
                            </div>
                        </div>
                        
                        <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-sm text-yellow-700">
                            <strong>üí° Como sincronizar:</strong>
                            <ol class="mt-2 list-decimal list-inside space-y-1">
                                <li>Clique em "Baixar TODOS os Arquivos CSV"</li>
                                <li>Salve os arquivos na pasta do Google Drive</li>
                                <li>Substitua os arquivos antigos pelos novos</li>
                            </ol>
                        </div>
                    </div>
                    
                    <!-- IMPORTAR (Trazer do Drive) -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="font-semibold text-gray-800 mb-4">üì• Importar Dados (do Computador)</h3>
                        <p class="text-sm text-gray-500 mb-4">Selecione os arquivos CSV do Google Drive para carregar no sistema.</p>
                        
                        <div class="border-2 border-dashed border-cyan-200 rounded-lg p-6 text-center bg-cyan-50 file-drop" id="dropZone">
                            <input type="file" id="csvFileInput" accept=".csv" class="hidden" onchange="handleCSVImport(event)">
                            <button onclick="document.getElementById('csvFileInput').click()" class="px-6 py-3 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-semibold transition">
                                üìÇ Selecionar Arquivo CSV
                            </button>
                            <p class="text-sm text-gray-500 mt-3">ou arraste e solte o arquivo aqui</p>
                        </div>
                        
                        <div class="mt-4">
                            <h4 class="font-medium text-gray-700 mb-2">Arquivos dispon√≠veis para importa√ß√£o:</h4>
                            <div class="space-y-2">
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" id="import-usuarios" class="rounded">
                                    <span>üë§ CSV_Usuarios.csv</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" id="import-clientes" class="rounded">
                                    <span>üë• CSV_Clientes.csv</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" id="import-fornecedores" class="rounded">
                                    <span>üöö CSV_Fornecedores.csv</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" id="import-produtos" class="rounded">
                                    <span>üì¶ CSV_Produtos.csv</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" id="import-os" class="rounded">
                                    <span>üìã CSV_OS.csv</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" id="import-producao" class="rounded">
                                    <span>‚öôÔ∏è CSV_Producao.csv</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" id="import-estoque" class="rounded">
                                    <span>üìà CSV_Estoque.csv</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" id="import-compras" class="rounded">
                                    <span>üõí CSV_Compras.csv</span>
                                </label>
                                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded hover:bg-gray-100 cursor-pointer">
                                    <input type="checkbox" id="import-empresa" class="rounded">
                                    <span>üè¢ CSV_Empresa.csv</span>
                                </label>
                            </div>
                            <button onclick="importSelectedCSV()" class="w-full mt-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition">
                                üì• Importar Selecionados
                            </button>
                        </div>
                        
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-700">
                            <strong>üí° Como sincronizar:</strong>
                            <ol class="mt-2 list-decimal list-inside space-y-1">
                                <li>Baixe os arquivos da pasta do Google Drive</li>
                                <li>Selecione os arquivos aqui usando "Selecionar Arquivo"</li>
                                <li>Marque os que deseja importar</li>
                                <li>Clique em "Importar Selecionados"</li>
                            </ol>
                        </div>
                    </div>
                </div>
                
                <!-- Resumo de Dados -->
                <div class="mt-6 bg-gray-50 rounded-xl p-4 md:p-6">
                    <h3 class="font-semibold text-gray-800 mb-4">üìä Status dos Dados Locais</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                        <div class="text-center p-3 bg-white rounded-lg shadow-sm">
                            <p class="text-2xl font-bold text-cyan-600" id="statRegistrosOS">0</p>
                            <p class="text-sm text-gray-500">Ordens de Servi√ßo</p>
                        </div>
                        <div class="text-center p-3 bg-white rounded-lg shadow-sm">
                            <p class="text-2xl font-bold text-green-600" id="statRegistrosClientes">0</p>
                            <p class="text-sm text-gray-500">Clientes</p>
                        </div>
                        <div class="text-center p-3 bg-white rounded-lg shadow-sm">
                            <p class="text-2xl font-bold text-purple-600" id="statRegistrosProdutos">0</p>
                            <p class="text-sm text-gray-500">Produtos</p>
                        </div>
                        <div class="text-center p-3 bg-white rounded-lg shadow-sm">
                            <p class="text-2xl font-bold text-orange-600" id="statRegistrosFornecedores">0</p>
                            <p class="text-sm text-gray-500">Fornecedores</p>
                        </div>
                        <div class="text-center p-3 bg-white rounded-lg shadow-sm">
                            <p class="text-2xl font-bold text-yellow-600" id="statRegistrosProducao">0</p>
                            <p class="text-sm text-gray-500">Produ√ß√£o</p>
                        </div>
                        <div class="text-center p-3 bg-white rounded-lg shadow-sm">
                            <p class="text-2xl font-bold text-red-600" id="statRegistrosCompras">0</p>
                            <p class="text-sm text-gray-500">Compras</p>
                        </div>
                    </div>
                    <p class="text-xs text-gray-400 mt-4 text-center">√öltima atualiza√ß√£o local: <span id="lastSync">-</span></p>
                </div>
            </section>
        </main>
    </div>

    <!-- MODAL OS -->
    <div id="osModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b flex justify-between items-center sticky top-0 bg-white z-10">
                <h3 class="text-xl font-bold text-gray-800" id="osModalTitle">Nova Ordem de Servi√ßo</h3>
                <button onclick="closeOSModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form id="osForm" class="p-6 space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Cliente</label>
                        <select id="osCliente" class="w-full px-4 py-2 border rounded-lg" required></select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Status</label>
                        <select id="osStatus" class="w-full px-4 py-2 border rounded-lg">
                            <option value="Or√ßamento">Or√ßamento</option>
                            <option value="Pedido">Pedido</option>
                            <option value="Produ√ß√£o">Produ√ß√£o</option>
                            <option value="Entregue">Entregue</option>
                        </select>
                    </div>
                </div>
                <div class="bg-gray-50 rounded-lg p-4">
                    <h4 class="font-semibold text-gray-800 mb-3">üì¶ Produtos/Servi√ßos</h4>
                    <div id="osProdutos" class="space-y-3"></div>
                    <button type="button" onclick="addOSProduto()" class="mt-3 text-cyan-600 hover:text-cyan-700 text-sm font-medium">
                        + Adicionar Produto
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Condi√ß√µes de Pagamento</label>
                        <input type="text" id="osPagamento" class="w-full px-4 py-2 border rounded-lg" placeholder="Ex: 30 dias">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Prazo de Entrega</label>
                        <input type="date" id="osPrazo" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-600 mb-1">Observa√ß√µes</label>
                    <textarea id="osObs" class="w-full px-4 py-2 border rounded-lg" rows="2" placeholder="Informa√ß√µes adicionais..."></textarea>
                </div>
                <div class="flex flex-col md:flex-row justify-end gap-3 pt-4">
                    <button type="button" onclick="closeOSModal()" class="px-6 py-2 border rounded-lg hover:bg-gray-50">Cancelar</button>
                    <button type="submit" class="px-6 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg">Salvar OS</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL CLIENTE -->
    <div id="clienteModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b flex justify-between items-center sticky top-0 bg-white z-10">
                <h3 class="text-xl font-bold text-gray-800" id="clienteModalTitle">Novo Cliente</h3>
                <button onclick="closeClienteModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form id="clienteForm" class="p-6 space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="md:col-span-2">
                        <label class="block text-sm text-gray-600 mb-1">Nome/Raz√£o Social *</label>
                        <input type="text" id="cliNome" required class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Nome Fantasia</label>
                        <input type="text" id="cliFantasia" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">CNPJ/CPF</label>
                        <input type="text" id="cliCNPJ" class="w-full px-4 py-2 border rounded-lg" placeholder="00.000.000/0000-00 ou 000.000.000-00">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">IE/RG</label>
                        <input type="text" id="cliIE" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Telefone Fixo</label>
                        <input type="text" id="cliTelefone" class="w-full px-4 py-2 border rounded-lg" placeholder="(00) 0000-0000">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Celular/WApp</label>
                        <input type="text" id="cliCelular" class="w-full px-4 py-2 border rounded-lg" placeholder="(00) 00000-0000">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">E-mail Principal</label>
                        <input type="email" id="cliEmail" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">E-mail NFe</label>
                        <input type="email" id="cliEmailNFe" class="w-full px-4 py-2 border rounded-lg" placeholder="E-mail para envio de NF-e">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm text-gray-600 mb-1">Endere√ßo Completo</label>
                        <input type="text" id="cliEndereco" class="w-full px-4 py-2 border rounded-lg" placeholder="Rua, n√∫mero, complemento, bairro">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">CEP</label>
                        <input type="text" id="cliCEP" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Cidade/UF</label>
                        <input type="text" id="cliCidade" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                </div>
                
                <div class="border-t pt-4 mt-4">
                    <h4 class="font-semibold text-gray-700 mb-3">üë§ Respons√°vel/Contato</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Nome do Respons√°vel</label>
                            <input type="text" id="cliResponsavel" class="w-full px-4 py-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Cargo</label>
                            <input type="text" id="cliCargoResp" class="w-full px-4 py-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Telefone do Respons√°vel</label>
                            <input type="text" id="cliContatoResp" class="w-full px-4 py-2 border rounded-lg">
                        </div>
                    </div>
                </div>
                
                <div class="border-t pt-4 mt-4">
                    <label class="block text-sm text-gray-600 mb-1">Observa√ß√µes</label>
                    <textarea id="cliObs" class="w-full px-4 py-2 border rounded-lg" rows="2" placeholder="Informa√ß√µes adicionais sobre o cliente..."></textarea>
                </div>
                
                <div class="flex flex-col md:flex-row justify-end gap-3 pt-4">
                    <button type="button" onclick="closeClienteModal()" class="px-6 py-2 border rounded-lg hover:bg-gray-50">Cancelar</button>
                    <button type="submit" class="px-6 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg">Salvar Cliente</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL FORNECEDOR -->
    <div id="fornecedorModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b flex justify-between items-center sticky top-0 bg-white z-10">
                <h3 class="text-xl font-bold text-gray-800" id="fornecedorModalTitle">Novo Fornecedor</h3>
                <button onclick="closeFornecedorModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form id="fornecedorForm" class="p-6 space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="md:col-span-2">
                        <label class="block text-sm text-gray-600 mb-1">Nome/Raz√£o Social *</label>
                        <input type="text" id="forNome" required class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Nome Fantasia</label>
                        <input type="text" id="forFantasia" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">CNPJ</label>
                        <input type="text" id="forCNPJ" class="w-full px-4 py-2 border rounded-lg" placeholder="00.000.000/0000-00">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">IE</label>
                        <input type="text" id="forIE" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Telefone</label>
                        <input type="text" id="forTelefone" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Celular</label>
                        <input type="text" id="forCelular" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">E-mail</label>
                        <input type="email" id="forEmail" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Site</label>
                        <input type="url" id="forSite" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm text-gray-600 mb-1">Endere√ßo</label>
                        <input type="text" id="forEndereco" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">CEP</label>
                        <input type="text" id="forCEP" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Cidade/UF</label>
                        <input type="text" id="forCidade" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Produtos Fornecidos</label>
                        <select id="forProdutos" class="w-full px-4 py-2 border rounded-lg" multiple style="height: 100px;">
                            <option value="TNT Polipropileno">TNT Polipropileno</option>
                            <option value="TNT SMS">TNT SMS</option>
                            <option value="TNT SMMS">TNT SMMS</option>
                            <option value="TNT SSMMSS">TNT SSMMSS</option>
                            <option value="El√°stico">El√°stico</option>
                            <option value="Z√≠per">Z√≠per</option>
                            <option value="Linha de Costura">Linha de Costura</option>
                            <option value="Velcro">Velcro</option>
                            <option value="Bot√£o">Bot√£o</option>
                            <option value="Embalagem">Embalagem</option>
                            <option value="Etiqueta">Etiqueta</option>
                            <option value="Caixa">Caixa de Papel√£o</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-1">Segure Ctrl/Cmd para selecionar m√∫ltiplos</p>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Prazo de Entrega Padr√£o</label>
                        <input type="text" id="forPrazo" class="w-full px-4 py-2 border rounded-lg" placeholder="Ex: 15 dias">
                        <div class="mt-3">
                            <label class="block text-sm text-gray-600 mb-1">Condi√ß√µes de Pagamento</label>
                            <input type="text" id="forPagamento" class="w-full px-4 py-2 border rounded-lg" placeholder="Ex: √Ä vista, 30 dias">
                        </div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm text-gray-600 mb-1">Observa√ß√µes</label>
                    <textarea id="forObs" class="w-full px-4 py-2 border rounded-lg" rows="2" placeholder="Informa√ß√µes adicionais..."></textarea>
                </div>
                
                <div class="flex flex-col md:flex-row justify-end gap-3 pt-4">
                    <button type="button" onclick="closeFornecedorModal()" class="px-6 py-2 border rounded-lg hover:bg-gray-50">Cancelar</button>
                    <button type="submit" class="px-6 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg">Salvar Fornecedor</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL PRODUTO -->
    <div id="produtoModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b flex justify-between items-center sticky top-0 bg-white z-10">
                <h3 class="text-xl font-bold text-gray-800" id="produtoModalTitle">Novo Produto</h3>
                <button onclick="closeProdutoModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form id="produtoForm" class="p-6 space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="lg:col-span-2">
                        <label class="block text-sm text-gray-600 mb-1">Nome do Produto *</label>
                        <input type="text" id="prodNome" required class="w-full px-4 py-2 border rounded-lg" placeholder="Ex: Avental Descart√°vel TNT">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">C√≥digo</label>
                        <input type="text" id="prodCodigo" class="w-full px-4 py-2 border rounded-lg" placeholder="Ex: AV-TNT-001">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Tipo</label>
                        <select id="prodTipo" class="w-full px-4 py-2 border rounded-lg">
                            <option value="Pr√≥prio">Pr√≥prio</option>
                            <option value="Terceirizado">Terceirizado</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Composi√ß√£o</label>
                        <select id="prodComposicao" class="w-full px-4 py-2 border rounded-lg">
                            <option value="100% Polipropileno">100% Polipropileno</option>
                            <option value="SMS">SMS</option>
                            <option value="SMMS">SMMS</option>
                            <option value="SSMMSS">SSMMSS</option>
                            <option value="TNT">Tecido N√£o Tecido (TNT)</option>
                            <option value="Tecido 100% Polipropileno">Tecido 100% Polipropileno</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Gramatura (g/m¬≤)</label>
                        <select id="prodGramatura" class="w-full px-4 py-2 border rounded-lg">
                            <option value="">Selecione...</option>
                            <option value="10">10 g/m¬≤</option>
                            <option value="15">15 g/m¬≤</option>
                            <option value="20">20 g/m¬≤</option>
                            <option value="25">25 g/m¬≤</option>
                            <option value="30">30 g/m¬≤</option>
                            <option value="35">35 g/m¬≤</option>
                            <option value="40">40 g/m¬≤</option>
                            <option value="45">45 g/m¬≤</option>
                            <option value="50">50 g/m¬≤</option>
                            <option value="55">55 g/m¬≤</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Uso/Ubica√ß√£o</label>
                        <select id="prodUso" class="w-full px-4 py-2 border rounded-lg">
                            <option value="Hospitalar">Hospitalar</option>
                            <option value="Cir√∫rgico">Cir√∫rgico</option>
                            <option value="Uso Geral">Uso Geral</option>
                            <option value="Procedimentos">Procedimentos</option>
                            <option value="Industrial">Industrial</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Tamanho</label>
                        <select id="prodTamanho" class="w-full px-4 py-2 border rounded-lg">
                            <option value="P">P (Pequeno)</option>
                            <option value="M">M (M√©dio)</option>
                            <option value="G">G (Grande)</option>
                            <option value="GG">GG (Extra Grande)</option>
                            <option value="XG">XG (Extra Grande)</option>
                            <option value="√önico">√önico</option>
                            <option value="Universal">Universal</option>
                            <option value="1,00 x 1,20m">1,00 x 1,20m</option>
                            <option value="1,00 x 1,40m">1,00 x 1,40m</option>
                            <option value="1,05 x 1,40m">1,05 x 1,40m</option>
                            <option value="1,10 x 1,40m">1,10 x 1,40m</option>
                            <option value="1,15 x 1,40m">1,15 x 1,40m</option>
                            <option value="1,20 x 1,40m">1,20 x 1,40m</option>
                            <option value="1,30 x 1,40m">1,30 x 1,40m</option>
                            <option value="1,25 x 1,55m">1,25 x 1,55m</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Esterilidade</label>
                        <select id="prodEsteril" class="w-full px-4 py-2 border rounded-lg">
                            <option value="N√£o est√©ril">N√£o est√©ril</option>
                            <option value="Est√©ril">Est√©ril</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Mangas</label>
                        <select id="prodMangas" class="w-full px-4 py-2 border rounded-lg">
                            <option value="Curtas">Curtas</option>
                            <option value="Longas">Longas</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Punho</label>
                        <select id="prodPuno" class="w-full px-4 py-2 border rounded-lg">
                            <option value="El√°stico">El√°stico</option>
                            <option value="Malha">Malha</option>
                            <option value="Sanfonado">Sanfonado</option>
                            <option value="L√°stex">L√°stex</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Embalagem</label>
                        <select id="prodEmbalagem" class="w-full px-4 py-2 border rounded-lg">
                            <option value="Unit√°rio">Unit√°rio</option>
                            <option value="Pacote 5">Pacote com 5</option>
                            <option value="Pacote 10">Pacote com 10</option>
                            <option value="Pacote 20">Pacote com 20</option>
                            <option value="Grau cir√∫rgico">Grau cir√∫rgico</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Cor</label>
                        <select id="prodCor" class="w-full px-4 py-2 border rounded-lg">
                            <option value="Branco">Branco</option>
                            <option value="Amarelo">Amarelo</option>
                            <option value="Azul">Azul</option>
                            <option value="Rosa">Rosa</option>
                            <option value="Verde">Verde</option>
                            <option value="N√£o definido">N√£o definido</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Valor Unit√°rio (R$) *</label>
                        <input type="number" id="prodValor" step="0.01" required class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Unidade de Venda</label>
                        <select id="prodUnidade" class="w-full px-4 py-2 border rounded-lg">
                            <option value="un">Unidade</option>
                            <option value="pacote">Pacote</option>
                            <option value="caixa">Caixa</option>
                            <option value="metro">Metro</option>
                            <option value="kg">Quilo</option>
                        </select>
                    </div>
                </div>
                
                <div class="border-t pt-4 mt-4">
                    <h4 class="font-semibold text-gray-700 mb-3">üîß Acabamentos e Caracter√≠sticas</h4>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="acabAberturaAtras" class="rounded">
                            <span class="text-sm">Abertura atr√°s</span>
                        </label>
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="acabOverlock" class="rounded">
                            <span class="text-sm">Overlock</span>
                        </label>
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="acabDecote" class="rounded">
                            <span class="text-sm">Decote em vi√©s</span>
                        </label>
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="acabTiraPescoco" class="rounded">
                            <span class="text-sm">Tira pesco√ßo</span>
                        </label>
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="acabTiraCintura" class="rounded">
                            <span class="text-sm">Tira cintura</span>
                        </label>
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="acabImpermeavel" class="rounded">
                            <span class="text-sm">Imperme√°vel</span>
                        </label>
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="acabSemLatex" class="rounded">
                            <span class="text-sm">Isento de l√°tex</span>
                        </label>
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="acabAntiflamma" class="rounded">
                            <span class="text-sm">N√£o inflam√°vel</span>
                        </label>
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="acabRepelente" class="rounded">
                            <span class="text-sm">Repelente a l√≠quidos</span>
                        </label>
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="acabAntifluidos" class="rounded">
                            <span class="text-sm">Repelente a fluidos</span>
                        </label>
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="acabBaixaParticula" class="rounded">
                            <span class="text-sm">Baixa libera√ß√£o part√≠culas</span>
                        </label>
                    </div>
                </div>
                
                <div class="border-t pt-4 mt-4">
                    <h4 class="font-semibold text-gray-700 mb-3">üì¶ Dados para Terceiriza√ß√£o (se aplic√°vel)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Marca</label>
                            <select id="prodMarca" class="w-full px-4 py-2 border rounded-lg">
                                <option value="">Pr√≥pria (MedSuCare)</option>
                                <option value="EASY SUPRI">EASY SUPRI</option>
                                <option value="PROTMED">PROTMED</option>
                                <option value="MAPLE">MAPLE</option>
                                <option value="LUVIX">LUVIX</option>
                                <option value="LATEX BR">LATEX BR</option>
                                <option value="BLANC">BLANC</option>
                                <option value="DESCARPAK">DESCARPAK</option>
                                <option value="AMAZON">AMAZON</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Fabricante</label>
                            <input type="text" id="prodFabricante" class="w-full px-4 py-2 border rounded-lg" placeholder="Nome do fabricante">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Registro ANVISA</label>
                            <input type="text" id="prodRegistroAnvisa" class="w-full px-4 py-2 border rounded-lg" placeholder="00000000000">
                        </div>
                    </div>
                </div>
                
                <div class="border-t pt-4 mt-4">
                    <h4 class="font-semibold text-gray-700 mb-3">üìÖ Validade e Lote</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Validade (meses)</label>
                            <input type="number" id="prodValidade" class="w-full px-4 py-2 border rounded-lg" placeholder="12, 24, 60">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Unidade por Embalagem</label>
                            <input type="number" id="prodUnidEmbalagem" class="w-full px-4 py-2 border rounded-lg" placeholder="1">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">C√≥digo de Barras (EAN)</label>
                            <input type="text" id="prodEAN" class="w-full px-4 py-2 border rounded-lg" placeholder="7890000000000">
                        </div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm text-gray-600 mb-1">Observa√ß√µes</label>
                    <textarea id="prodObs" class="w-full px-4 py-2 border rounded-lg" rows="2" placeholder="Informa√ß√µes adicionais..."></textarea>
                </div>
                
                <div class="flex flex-col md:flex-row justify-end gap-3 pt-4">
                    <button type="button" onclick="closeProdutoModal()" class="px-6 py-2 border rounded-lg hover:bg-gray-50">Cancelar</button>
                    <button type="submit" class="px-6 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg">Salvar Produto</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL PRODU√á√ÉO -->
    <div id="producaoModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b flex justify-between items-center sticky top-0 bg-white z-10">
                <h3 class="text-xl font-bold text-gray-800" id="producaoModalTitle">Atualizar Produ√ß√£o</h3>
                <button onclick="closeProducaoModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form id="producaoForm" class="p-6 space-y-4">
                <input type="hidden" id="prodId">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Ordem de Servi√ßo</label>
                        <select id="prodOS" class="w-full px-4 py-2 border rounded-lg" required></select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Etapa Atual</label>
                        <select id="prodEtapa" class="w-full px-4 py-2 border rounded-lg">
                            <option value="corte">1 - Corte</option>
                            <option value="costura">2 - Costura</option>
                            <option value="embalagem">3 - Embalagem</option>
                            <option value="entrega">4 - Entrega</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Quantidade Produzida</label>
                        <input type="number" id="prodQuantidade" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Respons√°vel</label>
                        <input type="text" id="prodResponsavel" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Data Prevista</label>
                        <input type="date" id="prodDataPrevista" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Data Conclus√£o</label>
                        <input type="date" id="prodDataConclusao" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                </div>
                <div id="transporteFields" class="hidden space-y-4">
                    <h4 class="font-semibold text-gray-800">üöö Informa√ß√µes de Transporte</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <input type="text" id="transpNome" placeholder="Nome do Transportador" class="w-full px-4 py-2 border rounded-lg">
                        <input type="text" id="transpVeiculo" placeholder="Ve√≠culo" class="w-full px-4 py-2 border rounded-lg">
                        <input type="text" id="transpPlaca" placeholder="Placa" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-600 mb-1">Observa√ß√µes</label>
                    <textarea id="prodObs" class="w-full px-4 py-2 border rounded-lg" rows="2" placeholder="Informa√ß√µes adicionais..."></textarea>
                </div>
                <div class="flex flex-col md:flex-row justify-end gap-3 pt-4">
                    <button type="button" onclick="closeProducaoModal()" class="px-6 py-2 border rounded-lg hover:bg-gray-50">Cancelar</button>
                    <button type="submit" class="px-6 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg">Atualizar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL ESTOQUE -->
    <div id="estoqueModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg">
            <div class="p-6 border-b flex justify-between items-center">
                <h3 class="text-xl font-bold text-gray-800" id="estoqueModalTitle">Novo Item de Estoque</h3>
                <button onclick="closeEstoqueModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form id="estoqueForm" class="p-6 space-y-4">
                <input type="hidden" id="estoqueId">
                <div>
                    <label class="block text-sm text-gray-600 mb-1">Nome do Item *</label>
                    <input type="text" id="estoqueItem" required class="w-full px-4 py-2 border rounded-lg">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Tipo</label>
                        <select id="estoqueTipo" class="w-full px-4 py-2 border rounded-lg">
                            <option value="Tecido">Tecido (TNT)</option>
                            <option value="Aviamento">Aviamento</option>
                            <option value="Embalagem">Embalagem</option>
                            <option value="Etiqueta">Etiqueta</option>
                            <option value="Acabamento">Acabamento</option>
                            <option value="Insumo">Insumo</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Unidade</label>
                        <select id="estoqueUnidade" class="w-full px-4 py-2 border rounded-lg">
                            <option value="m">Metro (m)</option>
                            <option value="kg">Quilo (kg)</option>
                            <option value="un">Unidade</option>
                            <option value="pacote">Pacote</option>
                            <option value="rolo">Rolo</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Quantidade Atual</label>
                        <input type="number" id="estoqueQuantidade" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Estoque M√≠nimo</label>
                        <input type="number" id="estoqueMin" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Estoque M√°ximo</label>
                        <input type="number" id="estoqueMax" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                </div>
                <div class="flex flex-col md:flex-row justify-end gap-3 pt-4">
                    <button type="button" onclick="closeEstoqueModal()" class="px-6 py-2 border rounded-lg hover:bg-gray-50">Cancelar</button>
                    <button type="submit" class="px-6 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="fixed bottom-4 right-4 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg hidden transform transition-all duration-300 translate-y-full opacity-0 z-50">
        <span id="toastMessage"></span>
    </div>

    <script>
        // ========== BANCO DE DADOS LOCAL ==========
        const DB = {
            users: [],
            pendingUsers: [],
            empresa: {
                razao: '', nome: '', abrev: 'MedSuCare', cnpj: '', ie: '', im: '',
                endereco: '', cep: '', cidade: '', pais: 'Brasil',
                telefone: '', celular: '', email: '', site: '',
                responsavel: '', respCPF: '', respCargo: '', logo: null, bancos: []
            },
            dadosAdicionais: {},
            clientes: [],
            fornecedores: [],
            produtos: [],
            os: [],
            producao: [],
            estoque: [],
            compras: [],
            financeiro: [],
            
            save(key) {
                try {
                    localStorage.setItem(`medsucare_${key}`, JSON.stringify(this[key]));
                } catch (e) {
                    console.warn(`Cannot save ${key}:`, e);
                }
            },
            
            saveAll() {
                this.save('users');
                this.save('pendingUsers');
                this.save('empresa');
                this.save('dados_adicionais');
                this.save('clientes');
                this.save('fornecedores');
                this.save('produtos');
                this.save('os');
                this.save('producao');
                this.save('estoque');
                this.save('compras');
                this.save('financeiro');
            },
            
            load(key) {
                try {
                    const data = localStorage.getItem(`medsucare_${key}`);
                    if (data) this[key] = JSON.parse(data);
                } catch (e) {
                    console.warn(`Cannot load ${key}:`, e);
                }
            },
            
            loadAll() {
                this.load('users');
                this.load('pendingUsers');
                this.load('empresa');
                this.load('dados_adicionais');
                this.load('clientes');
                this.load('fornecedores');
                this.load('produtos');
                this.load('os');
                this.load('producao');
                this.load('estoque');
                this.load('financeiro');
                this.updateSyncStatus();
            },
            
            updateSyncStatus() {
                const statusBar = document.getElementById('syncStatusBar');
                if (statusBar) {
                    statusBar.classList.remove('hidden');
                }
            }
        };

        // ========== AUTENTICA√á√ÉO ==========
        let currentUser = null;

        function ensureAdmin() {
            if (DB.users.find(u => u.role === 'ADMIN')) return;
            
            DB.users.push({
                id: 1, name: 'Administrador', email: 'admin@medsucare.com', password: 'admin123',
                role: 'ADMIN', status: 'active', cargo: 'Administrador', departamento: 'Administrativo',
                createdAt: new Date().toISOString(), lastAccess: null, accessCount: 0,
                accesses: ['dashboard', 'os', 'clientes', 'fornecedores', 'produtos', 'producao', 'estoque', 'vendas', 'compras', 'financeiro', 'usuarios', 'empresa', 'backup', 'relatorios']
            });
            DB.save('users');
        }

        function showLogin() {
            ensureAdmin();
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('appScreen').classList.add('hidden');
            document.getElementById('appScreen').classList.remove('flex');
        }

        function showRegister() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.remove('hidden');
        }

        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = DB.users.find(u => u.email === email && u.password === password && u.status === 'active');
            
            if (user) {
                user.lastAccess = new Date().toISOString();
                user.accessCount = (user.accessCount || 0) + 1;
                DB.save('users');
                
                currentUser = user;
                localStorage.setItem('medsucare_currentUser', JSON.stringify(user));
                initApp();
            } else {
                const errorDiv = document.getElementById('loginError');
                errorDiv.textContent = 'E-mail ou senha inv√°lidos!';
                errorDiv.classList.remove('hidden');
            }
        });

        document.getElementById('registerForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const role = document.getElementById('regRole').value;
            const departamento = document.getElementById('regDepartamento').value;
            
            if (DB.pendingUsers.find(u => u.email === email)) {
                alert('Este e-mail j√° possui uma solicita√ß√£o pendente!');
                return;
            }
            
            DB.pendingUsers.push({
                id: Date.now(), name, email, role, departamento, date: new Date().toISOString()
            });
            DB.save('pendingUsers');
            
            const successDiv = document.getElementById('registerSuccess');
            successDiv.textContent = '‚úÖ Solicita√ß√£o enviada ao administrador! Aguarde aprova√ß√£o.';
            successDiv.classList.remove('hidden');
            e.target.reset();
        });

        function logout() {
            currentUser = null;
            localStorage.removeItem('medsucare_currentUser');
            showLogin();
        }

        function initApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('appScreen').classList.remove('hidden');
            document.getElementById('appScreen').classList.add('flex');
            
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userRole').textContent = getRoleName(currentUser.role);
            document.getElementById('userInitial').textContent = currentUser.name.charAt(0).toUpperCase();
            
            if (currentUser.role === 'ADMIN' || currentUser.role === 'CEO') {
                document.getElementById('adminMenu').classList.remove('hidden');
            }
            
            updateMenuAccess();
            showSection('dashboard');
        }

        function updateMenuAccess() {
            document.querySelectorAll('.sidebar-item').forEach(item => {
                const section = item.id.replace('nav-', '');
                if (['usuarios', 'empresa', 'backup'].includes(section)) {
                    if (currentUser.role !== 'ADMIN' && currentUser.role !== 'CEO') {
                        item.classList.add('hidden');
                    }
                }
            });
        }

        function getRoleName(role) {
            const roles = {
                'CEO': 'CEO - Propriet√°rio', 'ADMIN': 'Administrador', 'DESIGNER': 'Designer',
                'COMPRADOR': 'Comprador', 'FORNECEDOR': 'Fornecedor', 'VENDEDOR': 'Vendedor',
                'PRODUCAO': 'Chefe de Produ√ß√£o', 'CONTADOR': 'Contador',
                'CORTADOR': 'Cortador', 'COSTUREIRA': 'Costureira', 'EMBALADOR': 'Embalador',
                'TRANSPORTADOR': 'Transportador', 'CLIENTE': 'Cliente'
            };
            return roles[role] || role;
        }

        // ========== NAVEGA√á√ÉO ==========
        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            document.getElementById(section).classList.remove('hidden');
            
            document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
            const navItem = document.getElementById(`nav-${section}`);
            if (navItem) navItem.classList.add('active');
            
            document.getElementById('sidebar').classList.remove('open');
            loadSectionData(section);
        }

        function toggleMobileMenu() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        function loadSectionData(section) {
            switch(section) {
                case 'dashboard': loadDashboard(); break;
                case 'os': loadOS(); break;
                case 'clientes': loadClientes(); break;
                case 'fornecedores': loadFornecedores(); break;
                case 'produtos': loadProdutos(); break;
                case 'producao': loadProducao(); break;
                case 'estoque': loadEstoque(); break;
                case 'vendas': loadVendas(); break;
                case 'compras': loadCompras(); break;
                case 'financeiro': loadFinanceiro(); break;
                case 'usuarios': loadUsuarios(); break;
                case 'empresa': loadEmpresa(); break;
                case 'backup': loadBackup(); break;
            }
        }

        // ========== ABAS ==========
        function switchTab(tabId) {
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            const btn = document.querySelector(`[data-tab="${tabId}"]`);
            if (btn) btn.classList.add('active');
        }

        // ========== DASHBOARD ==========
        function loadDashboard() {
            const osAberto = DB.os.filter(o => o.status !== 'Entregue').length;
            document.getElementById('statOS').textContent = osAberto;
            document.getElementById('statClientes').textContent = DB.clientes.length;
            
            const pedMes = DB.os.filter(o => o.status === 'Pedido' || o.status === 'Produ√ß√£o');
            document.getElementById('statPedidos').textContent = pedMes.length;
            
            const fat = DB.os.filter(o => o.status === 'Entregue').reduce((acc, o) => acc + (o.total || 0), 0);
            document.getElementById('statFaturamento').textContent = formatCurrency(fat);
            
            const recentOS = DB.os.slice(-5).reverse();
            document.getElementById('recentOS').innerHTML = recentOS.map(os => `
                <tr class="border-b">
                    <td class="px-3 py-2 font-mono text-xs">${os.numero}</td>
                    <td class="px-3 py-2">${os.clienteNome || '-'}</td>
                    <td class="px-3 py-2"><span class="px-2 py-1 rounded text-xs ${getStatusColor(os.status)}">${os.status}</span></td>
                </tr>
            `).join('') || '<tr><td colspan="3" class="px-3 py-4 text-center text-gray-500">Nenhuma OS encontrada</td></tr>';
            
            const prodAndamento = DB.producao.filter(p => p.status !== 'concluido');
            document.getElementById('producaoAndamento').innerHTML = prodAndamento.slice(-3).map(p => `
                <div class="p-3 bg-gray-50 rounded-lg">
                    <div class="flex justify-between">
                        <span class="font-medium">${p.os}</span>
                        <span class="text-sm text-gray-500">${getEtapaName(p.etapa)}</span>
                    </div>
                    <div class="text-sm text-gray-500">${p.quantidade} unidades - ${p.cliente || ''}</div>
                </div>
            `).join('') || '<p class="text-gray-500 text-sm">Nenhuma produ√ß√£o em andamento</p>';
        }

        function getStatusColor(status) {
            const colors = {'Or√ßamento': 'bg-yellow-100 text-yellow-700', 'Pedido': 'bg-blue-100 text-blue-700', 'Produ√ß√£o': 'bg-purple-100 text-purple-700', 'Entregue': 'bg-green-100 text-green-700'};
            return colors[status] || 'bg-gray-100 text-gray-700';
        }

        function getEtapaName(etapa) {
            const names = {'corte': '1 - Corte', 'costura': '2 - Costura', 'embalagem': '3 - Embalagem', 'entrega': '4 - Entrega'};
            return names[etapa] || etapa;
        }

        function getEtapaColor(etapa) {
            const colors = {'corte': 'bg-cyan-100 text-cyan-700', 'costura': 'bg-purple-100 text-purple-700', 'embalagem': 'bg-green-100 text-green-700', 'entrega': 'bg-orange-100 text-orange-700'};
            return colors[etapa] || 'bg-gray-100 text-gray-700';
        }

        // ========== ORDENS DE SERVI√áO ==========
        function loadOS() {
            renderOSTable(DB.os);
            populateClienteSelect();
        }

        function renderOSTable(osList) {
            document.getElementById('osTableBody').innerHTML = osList.map(os => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-3 font-mono text-xs">${os.numero}</td>
                    <td class="px-4 py-3 text-sm">${formatDateTime(os.data)}</td>
                    <td class="px-4 py-3 text-sm">${os.clienteNome || '-'}</td>
                    <td class="px-4 py-3"><span class="px-2 py-1 rounded text-xs ${getStatusColor(os.status)}">${os.status}</span></td>
                    <td class="px-4 py-3 font-medium">${formatCurrency(os.total)}</td>
                    <td class="px-4 py-3">
                        <div class="flex gap-2">
                            <button onclick="editOS('${os.numero}')" class="text-blue-600 hover:text-blue-800 text-sm" title="Editar">‚úèÔ∏è</button>
                            <button onclick="generatePDF('${os.numero}')" class="text-red-600 hover:text-red-800 text-sm" title="Gerar PDF">üìÑ</button>
                            <button onclick="deleteOS('${os.numero}')" class="text-red-600 hover:text-red-800 text-sm" title="Excluir">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="6" class="px-4 py-8 text-center text-gray-500">Nenhuma OS encontrada</td></tr>';
        }

        function filterOS() {
            const search = document.getElementById('searchOS').value.toLowerCase();
            const status = document.getElementById('filterStatusOS').value;
            let filtered = DB.os;
            if (search) filtered = filtered.filter(os => os.numero.toLowerCase().includes(search) || (os.clienteNome && os.clienteNome.toLowerCase().includes(search)));
            if (status) filtered = filtered.filter(os => os.status === status);
            renderOSTable(filtered);
        }

        let osEditing = null;

        function openOSModal(osNumero = null) {
            osEditing = osNumero;
            document.getElementById('osModalTitle').textContent = osNumero ? 'Editar OS' : 'Nova Ordem de Servi√ßo';
            document.getElementById('osModal').classList.remove('hidden');
            
            if (osNumero) {
                const os = DB.os.find(o => o.numero === osNumero);
                if (os) {
                    document.getElementById('osCliente').value = os.clienteId || '';
                    document.getElementById('osStatus').value = os.status;
                    document.getElementById('osPagamento').value = os.pagamento || '';
                    document.getElementById('osPrazo').value = os.prazo || '';
                    document.getElementById('osObs').value = os.obs || '';
                    renderOSProdutos(os.produtos || []);
                }
            } else {
                document.getElementById('osForm').reset();
                renderOSProdutos([]);
                addOSProduto();
            }
        }

        function closeOSModal() {
            document.getElementById('osModal').classList.add('hidden');
            osEditing = null;
        }

        function renderOSProdutos(produtos) {
            const container = document.getElementById('osProdutos');
            container.innerHTML = produtos.map((p, i) => {
                const prod = DB.produtos.find(pr => pr.id == p.produtoId);
                return `
                    <div class="grid grid-cols-12 gap-2 items-end p-3 bg-white rounded border">
                        <div class="col-span-4">
                            <label class="text-xs text-gray-500">Produto</label>
                            <select name="produto" class="w-full px-2 py-1 border rounded text-sm">
                                <option value="">Selecione...</option>
                                ${DB.produtos.map(prod => `<option value="${prod.id}" ${p.produtoId == prod.id ? 'selected' : ''}>${prod.nome}</option>`).join('')}
                            </select>
                        </div>
                        <div class="col-span-2">
                            <label class="text-xs text-gray-500">Qtd</label>
                            <input type="number" name="quantidade" value="${p.quantidade}" class="w-full px-2 py-1 border rounded text-sm">
                        </div>
                        <div class="col-span-2">
                            <label class="text-xs text-gray-500">Valor</label>
                            <input type="number" name="valor" value="${p.valor}" step="0.01" class="w-full px-2 py-1 border rounded text-sm">
                        </div>
                        <div class="col-span-3">
                            <label class="text-xs text-gray-500">Total</label>
                            <input type="text" value="${formatCurrency(p.quantidade * p.valor)}" readonly class="w-full px-2 py-1 border rounded text-sm bg-gray-50">
                        </div>
                        <div class="col-span-1">
                            <button type="button" onclick="this.closest('.grid').remove()" class="w-full py-1 text-red-500 hover:bg-red-50 rounded">√ó</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function addOSProduto() {
            const container = document.getElementById('osProdutos');
            const div = document.createElement('div');
            div.className = 'grid grid-cols-12 gap-2 items-end p-3 bg-white rounded border';
            div.innerHTML = `
                <div class="col-span-4">
                    <label class="text-xs text-gray-500">Produto</label>
                    <select name="produto" class="w-full px-2 py-1 border rounded text-sm">
                        <option value="">Selecione...</option>
                        ${DB.produtos.map(prod => `<option value="${prod.id}">${prod.nome}</option>`).join('')}
                    </select>
                </div>
                <div class="col-span-2">
                    <label class="text-xs text-gray-500">Qtd</label>
                    <input type="number" name="quantidade" value="1" class="w-full px-2 py-1 border rounded text-sm">
                </div>
                <div class="col-span-2">
                    <label class="text-xs text-gray-500">Valor</label>
                    <input type="number" name="valor" step="0.01" class="w-full px-2 py-1 border rounded text-sm">
                </div>
                <div class="col-span-3">
                    <label class="text-xs text-gray-500">Total</label>
                    <input type="text" value="R$ 0,00" readonly class="w-full px-2 py-1 border rounded text-sm bg-gray-50">
                </div>
                <div class="col-span-1">
                    <button type="button" onclick="this.closest('.grid').remove()" class="w-full py-1 text-red-500 hover:bg-red-50 rounded">√ó</button>
                </div>
            `;
            container.appendChild(div);
        }

        document.getElementById('osForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const now = new Date();
            const numero = osEditing || `${String(now.getDate()).padStart(2, '0')}${String(now.getMonth()+1).padStart(2, '0')}${now.getFullYear()}${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}`;
            
            const produtoRows = document.querySelectorAll('#osProdutos .grid');
            const produtos = Array.from(produtoRows).map(row => ({
                produtoId: row.querySelector('[name="produto"]').value,
                quantidade: parseInt(row.querySelector('[name="quantidade"]').value) || 0,
                valor: parseFloat(row.querySelector('[name="valor"]').value) || 0
            })).filter(p => p.produtoId);
            
            const total = produtos.reduce((acc, p) => acc + (p.quantidade * p.valor), 0);
            
            const osData = {
                numero,
                data: osEditing ? DB.os.find(o => o.numero === osEditing)?.data : now.toISOString(),
                clienteId: document.getElementById('osCliente').value,
                clienteNome: DB.clientes.find(c => c.id == document.getElementById('osCliente').value)?.nome || 'Cliente n√£o selecionado',
                status: document.getElementById('osStatus').value,
                produtos,
                total,
                pagamento: document.getElementById('osPagamento').value,
                prazo: document.getElementById('osPrazo').value,
                obs: document.getElementById('osObs').value
            };
            
            if (osEditing) {
                const index = DB.os.findIndex(o => o.numero === osEditing);
                DB.os[index] = osData;
            } else {
                DB.os.push(osData);
            }
            
            DB.save('os');
            closeOSModal();
            loadOS();
            showToast('OS salva com sucesso!');
        });

        function editOS(numero) { openOSModal(numero); }
        
        function deleteOS(numero) {
            if (confirm('Tem certeza que deseja excluir esta OS?')) {
                DB.os = DB.os.filter(o => o.numero !== numero);
                DB.save('os');
                loadOS();
                showToast('OS exclu√≠da!');
            }
        }

        function populateClienteSelect() {
            const select = document.getElementById('osCliente');
            select.innerHTML = '<option value="">Selecione...</option>' + DB.clientes.map(c => `<option value="${c.id}">${c.nome}</option>`).join('');
        }

        // ========== CLIENTES ==========
        function loadClientes() {
            renderClientesTable(DB.clientes);
        }

        function renderClientesTable(clientes) {
            document.getElementById('clientesTableBody').innerHTML = clientes.map(c => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-3 font-mono text-xs">${c.id}</td>
                    <td class="px-4 py-3">
                        <div class="font-medium">${c.nome}</div>
                        <div class="text-xs text-gray-500">${c.fantasia || ''}</div>
                    </td>
                    <td class="px-4 py-3 text-sm">${c.responsavel || '-'} / ${c.telefone || ''}</td>
                    <td class="px-4 py-3"><span class="px-2 py-1 rounded text-xs bg-green-100 text-green-700">Ativo</span></td>
                    <td class="px-4 py-3">
                        <div class="flex gap-2">
                            <button onclick="editCliente('${c.id}')" class="text-blue-600 hover:text-blue-800 text-sm" title="Editar">‚úèÔ∏è</button>
                            <button onclick="deleteCliente('${c.id}')" class="text-red-600 hover:text-red-800 text-sm" title="Excluir">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">Nenhum cliente cadastrado</td></tr>';
        }

        function filterClientes() {
            const search = document.getElementById('searchClientes').value.toLowerCase();
            const filtered = DB.clientes.filter(c => c.nome.toLowerCase().includes(search) || (c.fantasia && c.fantasia.toLowerCase().includes(search)));
            renderClientesTable(filtered);
        }

        let clienteEditing = null;

        function openClienteModal(id = null) {
            clienteEditing = id;
            document.getElementById('clienteModalTitle').textContent = id ? 'Editar Cliente' : 'Novo Cliente';
            document.getElementById('clienteModal').classList.remove('hidden');
            
            if (id) {
                const c = DB.clientes.find(cl => cl.id == id);
                if (c) {
                    document.getElementById('cliNome').value = c.nome || '';
                    document.getElementById('cliFantasia').value = c.fantasia || '';
                    document.getElementById('cliCNPJ').value = c.cnpj || '';
                    document.getElementById('cliIE').value = c.ie || '';
                    document.getElementById('cliTelefone').value = c.telefone || '';
                    document.getElementById('cliCelular').value = c.celular || '';
                    document.getElementById('cliEmail').value = c.email || '';
                    document.getElementById('cliEmailNFe').value = c.emailNFe || '';
                    document.getElementById('cliEndereco').value = c.endereco || '';
                    document.getElementById('cliCEP').value = c.cep || '';
                    document.getElementById('cliCidade').value = c.cidade || '';
                    document.getElementById('cliResponsavel').value = c.responsavel || '';
                    document.getElementById('cliCargoResp').value = c.cargoResp || '';
                    document.getElementById('cliContatoResp').value = c.contatoResp || '';
                    document.getElementById('cliObs').value = c.obs || '';
                }
            } else {
                document.getElementById('clienteForm').reset();
            }
        }

        function closeClienteModal() {
            document.getElementById('clienteModal').classList.add('hidden');
            clienteEditing = null;
        }

        document.getElementById('clienteForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const cliente = {
                id: clienteEditing || Date.now(),
                nome: document.getElementById('cliNome').value,
                fantasia: document.getElementById('cliFantasia').value,
                cnpj: document.getElementById('cliCNPJ').value,
                ie: document.getElementById('cliIE').value,
                telefone: document.getElementById('cliTelefone').value,
                celular: document.getElementById('cliCelular').value,
                email: document.getElementById('cliEmail').value,
                emailNFe: document.getElementById('cliEmailNFe').value,
                endereco: document.getElementById('cliEndereco').value,
                cep: document.getElementById('cliCEP').value,
                cidade: document.getElementById('cliCidade').value,
                responsavel: document.getElementById('cliResponsavel').value,
                cargoResp: document.getElementById('cliCargoResp').value,
                contatoResp: document.getElementById('cliContatoResp').value,
                obs: document.getElementById('cliObs').value,
                status: 'ativo',
                createdAt: new Date().toISOString()
            };
            
            if (clienteEditing) {
                const index = DB.clientes.findIndex(c => c.id == clienteEditing);
                DB.clientes[index] = cliente;
            } else {
                DB.clientes.push(cliente);
            }
            
            DB.save('clientes');
            closeClienteModal();
            loadClientes();
            showToast('Cliente salvo com sucesso!');
        });

        function editCliente(id) { openClienteModal(id); }
        
        function deleteCliente(id) {
            if (confirm('Tem certeza que deseja excluir este cliente?')) {
                DB.clientes = DB.clientes.filter(c => c.id != id);
                DB.save('clientes');
                loadClientes();
                showToast('Cliente exclu√≠do!');
            }
        }

        // ========== FORNECEDORES ==========
        function loadFornecedores() {
            renderFornecedoresTable(DB.fornecedores);
        }

        function renderFornecedoresTable(fornecedores) {
            document.getElementById('fornecedoresTableBody').innerHTML = fornecedores.map(f => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-3 font-mono text-xs">${f.id}</td>
                    <td class="px-4 py-3 font-medium">${f.nome}</td>
                    <td class="px-4 py-3 text-sm">${f.cnpj || '-'}</td>
                    <td class="px-4 py-3 text-sm">${(f.produtos || []).join(', ') || '-'}</td>
                    <td class="px-4 py-3">
                        <div class="flex gap-2">
                            <button onclick="editFornecedor('${f.id}')" class="text-blue-600 hover:text-blue-800 text-sm" title="Editar">‚úèÔ∏è</button>
                            <button onclick="deleteFornecedor('${f.id}')" class="text-red-600 hover:text-red-800 text-sm" title="Excluir">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">Nenhum fornecedor cadastrado</td></tr>';
        }

        function filterFornecedores() {
            const search = document.getElementById('searchFornecedores').value.toLowerCase();
            const filtered = DB.fornecedores.filter(f => f.nome.toLowerCase().includes(search));
            renderFornecedoresTable(filtered);
        }

        let fornecedorEditing = null;

        function openFornecedorModal(id = null) {
            fornecedorEditing = id;
            document.getElementById('fornecedorModalTitle').textContent = id ? 'Editar Fornecedor' : 'Novo Fornecedor';
            document.getElementById('fornecedorModal').classList.remove('hidden');
            
            if (id) {
                const f = DB.fornecedores.find(fo => fo.id == id);
                if (f) {
                    document.getElementById('forNome').value = f.nome || '';
                    document.getElementById('forFantasia').value = f.fantasia || '';
                    document.getElementById('forCNPJ').value = f.cnpj || '';
                    document.getElementById('forIE').value = f.ie || '';
                    document.getElementById('forTelefone').value = f.telefone || '';
                    document.getElementById('forCelular').value = f.celular || '';
                    document.getElementById('forEmail').value = f.email || '';
                    document.getElementById('forSite').value = f.site || '';
                    document.getElementById('forEndereco').value = f.endereco || '';
                    document.getElementById('forCEP').value = f.cep || '';
                    document.getElementById('forCidade').value = f.cidade || '';
                    document.getElementById('forPrazo').value = f.prazo || '';
                    document.getElementById('forPagamento').value = f.pagamento || '';
                    document.getElementById('forObs').value = f.obs || '';
                }
            } else {
                document.getElementById('fornecedorForm').reset();
            }
        }

        function closeFornecedorModal() {
            document.getElementById('fornecedorModal').classList.add('hidden');
            fornecedorEditing = null;
        }

        document.getElementById('fornecedorForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const select = document.getElementById('forProdutos');
            const produtos = Array.from(select.selectedOptions).map(o => o.value);
            
            const fornecedor = {
                id: fornecedorEditing || Date.now(),
                nome: document.getElementById('forNome').value,
                fantasia: document.getElementById('forFantasia').value,
                cnpj: document.getElementById('forCNPJ').value,
                ie: document.getElementById('forIE').value,
                telefone: document.getElementById('forTelefone').value,
                celular: document.getElementById('forCelular').value,
                email: document.getElementById('forEmail').value,
                site: document.getElementById('forSite').value,
                endereco: document.getElementById('forEndereco').value,
                cep: document.getElementById('forCEP').value,
                cidade: document.getElementById('forCidade').value,
                produtos,
                prazo: document.getElementById('forPrazo').value,
                pagamento: document.getElementById('forPagamento').value,
                obs: document.getElementById('forObs').value,
                status: 'ativo'
            };
            
            if (fornecedorEditing) {
                const index = DB.fornecedores.findIndex(f => f.id == fornecedorEditing);
                DB.fornecedores[index] = fornecedor;
            } else {
                DB.fornecedores.push(fornecedor);
            }
            
            DB.save('fornecedores');
            closeFornecedorModal();
            loadFornecedores();
            showToast('Fornecedor salvo com sucesso!');
        });

        function editFornecedor(id) { openFornecedorModal(id); }
        
        function deleteFornecedor(id) {
            if (confirm('Tem certeza que deseja excluir este fornecedor?')) {
                DB.fornecedores = DB.fornecedores.filter(f => f.id != id);
                DB.save('fornecedores');
                loadFornecedores();
                showToast('Fornecedor exclu√≠do!');
            }
        }

        // ========== PRODUTOS ==========
        function loadProdutos() {
            const grid = document.getElementById('produtosGrid');
            grid.innerHTML = DB.produtos.map(p => `
                <div class="bg-white rounded-xl shadow-sm p-4 card-hover transition">
                    <div class="flex justify-between items-start mb-2">
                        <span class="px-2 py-1 rounded text-xs ${p.tipo === 'Pr√≥prio' ? 'bg-green-100 text-green-700' : 'bg-purple-100 text-purple-700'}">${p.tipo}</span>
                        <div class="flex gap-1">
                            <button onclick="editProduto('${p.id}')" class="text-gray-400 hover:text-blue-600 text-sm">‚úèÔ∏è</button>
                            <button onclick="deleteProduto('${p.id}')" class="text-gray-400 hover:text-red-600 text-sm">üóëÔ∏è</button>
                        </div>
                    </div>
                    <h3 class="font-semibold text-gray-800 mb-1">${p.nome}</h3>
                    <p class="text-xs text-gray-500 mb-2">${p.codigo || 'Sem c√≥digo'}</p>
                    <div class="text-xs text-gray-500 space-y-1">
                        <p>üìê ${p.composicao} - ${p.gramatura}g/m¬≤</p>
                        <p>üìè ${p.tamanho} - ${p.esteril}</p>
                        <p>üßµ ${p.mangas} / ${p.punho}</p>
                        <p>üì¶ ${p.embalagem} - ${p.cor}</p>
                        ${p.marca ? `<p>üè∑Ô∏è ${p.marca}</p>` : ''}
                    </div>
                    <div class="mt-3 pt-3 border-t flex justify-between items-center">
                        <span class="text-lg font-bold text-cyan-600">${formatCurrency(p.valor)}</span>
                    </div>
                </div>
            `).join('') || `
                <div class="col-span-3 text-center py-8">
                    <p class="text-gray-500 mb-4">Nenhum produto cadastrado.</p>
                    <button onclick="openProdutoModal()" class="bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded-lg">+ Novo Produto</button>
                </div>
            `;
        }

        let produtoEditing = null;

        function openProdutoModal(id = null) {
            produtoEditing = id;
            document.getElementById('produtoModalTitle').textContent = id ? 'Editar Produto' : 'Novo Produto';
            document.getElementById('produtoModal').classList.remove('hidden');
            
            if (id) {
                const p = DB.produtos.find(pro => pro.id == id);
                if (p) {
                    document.getElementById('prodNome').value = p.nome || '';
                    document.getElementById('prodCodigo').value = p.codigo || '';
                    document.getElementById('prodTipo').value = p.tipo || 'Pr√≥prio';
                    document.getElementById('prodComposicao').value = p.composicao || '100% Polipropileno';
                    document.getElementById('prodGramatura').value = p.gramatura || '';
                    document.getElementById('prodUso').value = p.uso || 'Hospitalar';
                    document.getElementById('prodTamanho').value = p.tamanho || 'M';
                    document.getElementById('prodEsteril').value = p.esteril || 'N√£o est√©ril';
                    document.getElementById('prodMangas').value = p.mangas || 'Curtas';
                    document.getElementById('prodPuno').value = p.punho || 'El√°stico';
                    document.getElementById('prodEmbalagem').value = p.embalagem || 'Unit√°rio';
                    document.getElementById('prodCor').value = p.cor || 'Branco';
                    document.getElementById('prodValor').value = p.valor || '';
                    document.getElementById('prodUnidade').value = p.unidade || 'un';
                    document.getElementById('prodMarca').value = p.marca || '';
                    document.getElementById('prodFabricante').value = p.fabricante || '';
                    document.getElementById('prodRegistroAnvisa').value = p.registroAnvisa || '';
                    document.getElementById('prodValidade').value = p.validade || '';
                    document.getElementById('prodUnidEmbalagem').value = p.unidEmbalagem || '';
                    document.getElementById('prodEAN').value = p.ean || '';
                    document.getElementById('prodObs').value = p.obs || '';
                    
                    if (p.acabamentos) {
                        document.getElementById('acabAberturaAtras').checked = p.acabamentos.aberturaAtras;
                        document.getElementById('acabOverlock').checked = p.acabamentos.overlock;
                        document.getElementById('acabDecote').checked = p.acabamentos.decote;
                        document.getElementById('acabTiraPescoco').checked = p.acabamentos.tiraPescoco;
                        document.getElementById('acabTiraCintura').checked = p.acabamentos.tiraCintura;
                        document.getElementById('acabImpermeavel').checked = p.acabamentos.impermeavel;
                        document.getElementById('acabSemLatex').checked = p.acabamentos.semLatex;
                        document.getElementById('acabAntiflamma').checked = p.acabamentos.antiflamma;
                        document.getElementById('acabRepelente').checked = p.acabamentos.repelente;
                        document.getElementById('acabAntifluidos').checked = p.acabamentos.antifluidos;
                        document.getElementById('acabBaixaParticula').checked = p.acabamentos.baixaParticula;
                    }
                }
            } else {
                document.getElementById('produtoForm').reset();
                document.querySelectorAll('#produtoForm input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
        }

        function closeProdutoModal() {
            document.getElementById('produtoModal').classList.add('hidden');
            produtoEditing = null;
        }

        document.getElementById('produtoForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const produto = {
                id: produtoEditing || Date.now(),
                nome: document.getElementById('prodNome').value,
                codigo: document.getElementById('prodCodigo').value,
                tipo: document.getElementById('prodTipo').value,
                composicao: document.getElementById('prodComposicao').value,
                gramatura: document.getElementById('prodGramatura').value,
                uso: document.getElementById('prodUso').value,
                tamanho: document.getElementById('prodTamanho').value,
                esteril: document.getElementById('prodEsteril').value,
                mangas: document.getElementById('prodMangas').value,
                punho: document.getElementById('prodPuno').value,
                embalagem: document.getElementById('prodEmbalagem').value,
                cor: document.getElementById('prodCor').value,
                valor: parseFloat(document.getElementById('prodValor').value) || 0,
                unidade: document.getElementById('prodUnidade').value,
                marca: document.getElementById('prodMarca').value,
                fabricante: document.getElementById('prodFabricante').value,
                registroAnvisa: document.getElementById('prodRegistroAnvisa').value,
                validade: document.getElementById('prodValidade').value,
                unidEmbalagem: document.getElementById('prodUnidEmbalagem').value,
                ean: document.getElementById('prodEAN').value,
                obs: document.getElementById('prodObs').value,
                createdAt: new Date().toISOString(),
                acabamento: {
                    aberturaAtras: document.getElementById('acabAberturaAtras').checked,
                    overlock: document.getElementById('acabOverlock').checked,
                    decote: document.getElementById('acabDecote').checked,
                    tiraPescoco: document.getElementById('acabTiraPescoco').checked,
                    tiraCintura: document.getElementById('acabTiraCintura').checked,
                    impermeavel: document.getElementById('acabImpermeavel').checked,
                    semLatex: document.getElementById('acabSemLatex').checked,
                    antiflamma: document.getElementById('acabAntiflamma').checked,
                    repelente: document.getElementById('acabRepelente').checked,
                    antifluidos: document.getElementById('acabAntifluidos').checked,
                    baixaParticula: document.getElementById('acabBaixaParticula').checked
                }
            };
            
            if (produtoEditing) {
                const index = DB.produtos.findIndex(p => p.id == produtoEditing);
                DB.produtos[index] = produto;
            } else {
                DB.produtos.push(produto);
            }
            
            DB.save('produtos');
            closeProdutoModal();
            loadProdutos();
            showToast('Produto salvo com sucesso!');
        });

        function editProduto(id) { openProdutoModal(id); }
        
        function deleteProduto(id) {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                DB.produtos = DB.produtos.filter(p => p.id != id);
                DB.save('produtos');
                loadProdutos();
                showToast('Produto exclu√≠do!');
            }
        }

        // ========== PRODU√á√ÉO ==========
        function loadProducao() {
            document.getElementById('prodCorte').textContent = DB.producao.filter(p => p.etapa === 'corte' && p.status !== 'concluido').length;
            document.getElementById('prodCostura').textContent = DB.producao.filter(p => p.etapa === 'costura' && p.status !== 'concluido').length;
            document.getElementById('prodEmbalagem').textContent = DB.producao.filter(p => p.etapa === 'embalagem' && p.status !== 'concluido').length;
            document.getElementById('prodEntrega').textContent = DB.producao.filter(p => p.etapa === 'entrega' && p.status !== 'concluido').length;
            
            renderProducaoTable(DB.producao);
            populateOSSelect();
        }

        function populateOSSelect() {
            const select = document.getElementById('prodOS');
            select.innerHTML = '<option value="">Selecione...</option>' + DB.os.map(o => `<option value="${o.numero}">${o.numero} - ${o.clienteNome}</option>`).join('');
        }

        function renderProducaoTable(list) {
            document.getElementById('producaoTableBody').innerHTML = list.map(p => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-3 font-mono text-xs">${p.os}</td>
                    <td class="px-4 py-3 text-sm">${p.cliente || '-'}</td>
                    <td class="px-4 py-3 text-sm">${p.quantidade}</td>
                    <td class="px-4 py-3"><span class="px-2 py-1 rounded text-xs ${getEtapaColor(p.etapa)}">${getEtapaName(p.etapa)}</span></td>
                    <td class="px-4 py-3 text-sm">${p.responsavel || '-'}</td>
                    <td class="px-4 py-3">
                        <div class="flex gap-2">
                            <button onclick="editProducao('${p.id}')" class="text-blue-600 hover:text-blue-800 text-sm" title="Editar">‚úèÔ∏è</button>
                            <button onclick="deleteProducao('${p.id}')" class="text-red-600 hover:text-red-800 text-sm" title="Excluir">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="6" class="px-4 py-8 text-center text-gray-500">Nenhum registro de produ√ß√£o</td></tr>';
        }

        function filterProducao() {
            const etapa = document.getElementById('filterEtapaProducao').value;
            const filtered = etapa ? DB.producao.filter(p => p.etapa === etapa) : DB.producao;
            renderProducaoTable(filtered);
        }

        let producaoEditing = null;

        function openProducaoModal(id = null) {
            producaoEditing = id;
            document.getElementById('producaoModalTitle').textContent = id ? 'Editar Produ√ß√£o' : 'Nova Produ√ß√£o';
            document.getElementById('producaoModal').classList.remove('hidden');
            
            populateOSSelect();
            
            if (id) {
                const p = DB.producao.find(pro => pro.id == id);
                if (p) {
                    document.getElementById('prodOS').value = p.os;
                    document.getElementById('prodEtapa').value = p.etapa;
                    document.getElementById('prodQuantidade').value = p.quantidade;
                    document.getElementById('prodResponsavel').value = p.responsavel;
                    document.getElementById('prodDataPrevista').value = p.dataPrevista || '';
                    document.getElementById('prodDataConclusao').value = p.dataConclusao || '';
                    document.getElementById('prodObs').value = p.obs || '';
                    
                    if (p.transporte) {
                        document.getElementById('transporteFields').classList.remove('hidden');
                        document.getElementById('transpNome').value = p.transporte.nome || '';
                        document.getElementById('transpVeiculo').value = p.transporte.veiculo || '';
                        document.getElementById('transpPlaca').value = p.transporte.placa || '';
                    }
                }
            } else {
                document.getElementById('producaoForm').reset();
                document.getElementById('transporteFields').classList.add('hidden');
            }
        }

        function closeProducaoModal() {
            document.getElementById('producaoModal').classList.add('hidden');
            producaoEditing = null;
        }

        document.getElementById('prodEtapa').addEventListener('change', (e) => {
            const fields = document.getElementById('transporteFields');
            if (e.target.value === 'entrega') {
                fields.classList.remove('hidden');
            } else {
                fields.classList.add('hidden');
            }
        });

        document.getElementById('producaoForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const os = DB.os.find(o => o.numero === document.getElementById('prodOS').value);
            
            const producao = {
                id: producaoEditing || Date.now(),
                os: document.getElementById('prodOS').value,
                cliente: os?.clienteNome || '-',
                etapa: document.getElementById('prodEtapa').value,
                quantidade: parseInt(document.getElementById('prodQuantidade').value) || 0,
                responsavel: document.getElementById('prodResponsavel').value,
                dataPrevista: document.getElementById('prodDataPrevista').value,
                dataConclusao: document.getElementById('prodDataConclusao').value,
                obs: document.getElementById('prodObs').value,
                status: document.getElementById('prodEtapa').value === 'entrega' ? 'concluido' : 'andamento',
                transporte: document.getElementById('prodEtapa').value === 'entrega' ? {
                    nome: document.getElementById('transpNome').value,
                    veiculo: document.getElementById('transpVeiculo').value,
                    placa: document.getElementById('transpPlaca').value
                } : null
            };
            
            if (producaoEditing) {
                const index = DB.producao.findIndex(p => p.id == producaoEditing);
                DB.producao[index] = producao;
            } else {
                DB.producao.push(producao);
            }
            
            DB.save('producao');
            closeProducaoModal();
            loadProducao();
            showToast('Produ√ß√£o atualizada!');
        });

        function editProducao(id) { openProducaoModal(id); }
        
        function deleteProducao(id) {
            if (confirm('Tem certeza que deseja excluir este registro?')) {
                DB.producao = DB.producao.filter(p => p.id != id);
                DB.save('producao');
                loadProducao();
                showToast('Registro exclu√≠do!');
            }
        }

        // ========== ESTOQUE ==========
        function loadEstoque() {
            const tecidos = DB.estoque.filter(e => e.tipo === 'Tecido').reduce((acc, e) => acc + e.quantidade, 0);
            const aviamentos = DB.estoque.filter(e => e.tipo === 'Aviamento').length;
            const embalagens = DB.estoque.filter(e => ['Embalagem', 'Etiqueta'].includes(e.tipo)).reduce((acc, e) => acc + e.quantidade, 0);
            
            document.getElementById('estoqueTecidos').textContent = tecidos;
            document.getElementById('estoqueAviamentos').textContent = aviamentos;
            document.getElementById('estoqueEmbalagens').textContent = embalagens;
            
            renderEstoqueTable(DB.estoque);
        }

        function renderEstoqueTable(estoque) {
            document.getElementById('estoqueTableBody').innerHTML = estoque.map(e => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-3 font-medium">${e.item}</td>
                    <td class="px-4 py-3 text-sm">${e.tipo}</td>
                    <td class="px-4 py-3"><span class="${e.quantidade <= e.min ? 'text-red-600 font-bold' : ''}">${e.quantidade} ${e.unidade || ''}</span></td>
                    <td class="px-4 py-3 text-sm text-gray-500">${e.min || 0}/${e.max || 0}</td>
                    <td class="px-4 py-3">
                        <button onclick="ajustarEstoque('${e.id}')" class="text-cyan-600 hover:text-cyan-800 text-sm">¬± Ajustar</button>
                        <button onclick="editEstoque('${e.id}')" class="text-blue-600 hover:text-blue-800 text-sm ml-2">‚úèÔ∏è</button>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">Nenhum item no estoque</td></tr>';
        }

        function filterEstoque() {
            const search = document.getElementById('searchEstoque').value.toLowerCase();
            const filtered = DB.estoque.filter(e => e.item.toLowerCase().includes(search));
            renderEstoqueTable(filtered);
        }

        let estoqueEditing = null;

        function openEstoqueModal(id = null) {
            estoqueEditing = id;
            document.getElementById('estoqueModalTitle').textContent = id ? 'Editar Item' : 'Novo Item de Estoque';
            document.getElementById('estoqueModal').classList.remove('hidden');
            
            if (id) {
                const e = DB.estoque.find(item => item.id == id);
                if (e) {
                    document.getElementById('estoqueId').value = e.id;
                    document.getElementById('estoqueItem').value = e.item;
                    document.getElementById('estoqueTipo').value = e.tipo;
                    document.getElementById('estoqueUnidade').value = e.unidade || 'm';
                    document.getElementById('estoqueQuantidade').value = e.quantidade;
                    document.getElementById('estoqueMin').value = e.min || '';
                    document.getElementById('estoqueMax').value = e.max || '';
                }
            } else {
                document.getElementById('estoqueForm').reset();
            }
        }

        function closeEstoqueModal() {
            document.getElementById('estoqueModal').classList.add('hidden');
            estoqueEditing = null;
        }

        function editEstoque(id) { openEstoqueModal(id); }

        document.getElementById('estoqueForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const item = {
                id: estoqueEditing || Date.now(),
                item: document.getElementById('estoqueItem').value,
                tipo: document.getElementById('estoqueTipo').value,
                unidade: document.getElementById('estoqueUnidade').value,
                quantidade: parseInt(document.getElementById('estoqueQuantidade').value) || 0,
                min: parseInt(document.getElementById('estoqueMin').value) || 0,
                max: parseInt(document.getElementById('estoqueMax').value) || 0
            };
            
            if (estoqueEditing) {
                const index = DB.estoque.findIndex(i => i.id == estoqueEditing);
                DB.estoque[index] = item;
            } else {
                DB.estoque.push(item);
            }
            
            DB.save('estoque');
            closeEstoqueModal();
            loadEstoque();
            showToast('Item salvo com sucesso!');
        });

        function ajustarEstoque(id) {
            const item = DB.estoque.find(e => e.id == id);
            if (!item) return;
            
            const ajuste = prompt(`Ajustar estoque de "${item.item}"\nAtual: ${item.quantidade}\nDigite o novo valor:`, item.quantidade);
            if (ajuste !== null) {
                const novoValor = parseInt(ajuste);
                if (!isNaN(novoValor) && novoValor >= 0) {
                    item.quantidade = novoValor;
                    DB.save('estoque');
                    loadEstoque();
                    showToast('Estoque ajustado!');
                }
            }
        }

        // ========== VENDAS ==========
        function loadVendas() {
            const orcamentos = DB.os.filter(o => o.status === 'Or√ßamento').length;
            const pedidos = DB.os.filter(o => o.status === 'Pedido' || o.status === 'Produ√ß√£o').length;
            const finalizadas = DB.os.filter(o => o.status === 'Entregue').length;
            const total = DB.os.filter(o => o.status === 'Entregue').reduce((acc, o) => acc + (o.total || 0), 0);
            
            document.getElementById('vendasOrcamentos').textContent = orcamentos;
            document.getElementById('vendasPedidos').textContent = pedidos;
            document.getElementById('vendasFinalizadas').textContent = finalizadas;
            document.getElementById('vendasTotal').textContent = formatCurrency(total);
            
            const chart = document.getElementById('chartVendas');
            const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'];
            const heights = [60, 80, 45, 90, 70, 85];
            chart.innerHTML = months.map((m, i) => `
                <div class="flex flex-col items-center gap-1">
                    <div class="w-8 bg-cyan-500 rounded-t transition-all hover:bg-cyan-600" style="height: ${heights[i]}px"></div>
                    <span class="text-xs text-gray-500">${m}</span>
                </div>
            `).join('');
        }

        // ========== COMPRAS ==========
        function loadCompras() {
            const select = document.getElementById('compraFornecedor');
            select.innerHTML = '<option value="">Selecione...</option>' + DB.fornecedores.map(f => `<option value="${f.id}">${f.nome}</option>`).join('');
            
            renderComprasList();
        }

        function renderComprasList() {
            const list = document.getElementById('comprasList');
            list.innerHTML = DB.compras.slice(-10).reverse().map(c => `
                <div class="p-3 bg-gray-50 rounded-lg">
                    <div class="flex justify-between">
                        <span class="font-medium">${c.fornecedorNome}</span>
                        <span class="text-sm text-gray-500">${formatDate(c.data)}</span>
                    </div>
                    <div class="text-sm text-gray-600">${c.material}</div>
                    <div class="flex justify-between mt-2">
                        <span class="text-sm">Qtd: ${c.quantidade}</span>
                        <span class="font-semibold text-green-600">${formatCurrency(c.total)}</span>
                    </div>
                </div>
            `).join('') || '<p class="text-gray-500 text-sm">Nenhuma compra registrada</p>';
        }

        document.getElementById('compraForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const fornecedor = DB.fornecedores.find(f => f.id == document.getElementById('compraFornecedor').value);
            
            const compra = {
                id: Date.now(),
                fornecedorId: document.getElementById('compraFornecedor').value,
                fornecedorNome: fornecedor?.nome || '-',
                material: document.getElementById('compraMaterial').value,
                quantidade: parseInt(document.getElementById('compraQuantidade').value),
                valorUnit: parseFloat(document.getElementById('compraValor').value),
                total: parseInt(document.getElementById('compraQuantidade').value) * parseFloat(document.getElementById('compraValor').value),
                obs: document.getElementById('compraObs').value,
                data: new Date().toISOString(),
                status: 'pendente'
            };
            
            DB.compras.push(compra);
            DB.save('compras');
            e.target.reset();
            loadCompras();
            showToast('Solicita√ß√£o de compra registrada!');
        });

        // ========== FINANCEIRO ==========
        function loadFinanceiro() {
            const receber = DB.os.filter(o => o.status === 'Entregue').reduce((acc, o) => acc + (o.total || 0), 0);
            const pagar = DB.compras.reduce((acc, c) => acc + (c.total || 0), 0);
            
            document.getElementById('finReceber').textContent = formatCurrency(receber);
            document.getElementById('finPagar').textContent = formatCurrency(pagar);
            document.getElementById('finSaldo').textContent = formatCurrency(receber - pagar);
            
            document.getElementById('contasReceber').innerHTML = DB.os.filter(o => o.status === 'Entregue').map(o => `
                <tr class="border-b">
                    <td class="px-3 py-2 text-sm">${o.clienteNome}</td>
                    <td class="px-3 py-2 text-sm">${o.prazo ? formatDate(o.prazo) : '-'}</td>
                    <td class="px-3 py-2 text-sm font-medium">${formatCurrency(o.total)}</td>
                    <td class="px-3 py-2"><span class="px-2 py-1 rounded text-xs bg-yellow-100 text-yellow-700">Pendente</span></td>
                </tr>
            `).join('') || '<tr><td colspan="4" class="px-3 py-4 text-center text-gray-500">Nenhuma conta a receber</td></tr>';
            
            document.getElementById('contasPagar').innerHTML = DB.compras.map(c => `
                <tr class="border-b">
                    <td class="px-3 py-2 text-sm">${c.fornecedorNome}</td>
                    <td class="px-3 py-2 text-sm">${formatDate(c.data)}</td>
                    <td class="px-3 py-2 text-sm font-medium">${formatCurrency(c.total)}</td>
                    <td class="px-3 py-2"><span class="px-2 py-1 rounded text-xs bg-yellow-100 text-yellow-700">Pendente</span></td>
                </tr>
            `).join('') || '<tr><td colspan="4" class="px-3 py-4 text-center text-gray-500">Nenhuma conta a pagar</td></tr>';
        }

        // ========== RELAT√ìRIOS ==========
        function generateReport(type) {
            showToast(`Gerando relat√≥rio de ${type}...`);
        }

        // ========== USU√ÅRIOS (ADMIN) ==========
        function loadUsuarios() {
            document.getElementById('pendingUsers').innerHTML = DB.pendingUsers.map(u => `
                <div class="flex flex-col md:flex-row justify-between items-center gap-3 p-3 bg-yellow-50 rounded-lg">
                    <div class="text-center md:text-left">
                        <span class="font-medium">${u.name}</span>
                        <span class="text-sm text-gray-500">(${u.email})</span>
                        <span class="text-xs text-gray-400 ml-2">${getRoleName(u.role)} - ${u.departamento}</span>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="approveUser('${u.id}')" class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700">Aprovar</button>
                        <button onclick="rejectUser('${u.id}')" class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700">Rejeitar</button>
                    </div>
                </div>
            `).join('') || '<p class="text-gray-500 text-sm">Nenhuma solicita√ß√£o pendente</p>';
            
            document.getElementById('usersTableBody').innerHTML = DB.users.map(u => `
                <tr class="border-b">
                    <td class="px-4 py-3 font-medium">${u.name}</td>
                    <td class="px-4 py-3 text-sm">${u.email}</td>
                    <td class="px-4 py-3 text-sm">${getRoleName(u.role)}</td>
                    <td class="px-4 py-3 text-sm">${u.departamento || '-'}</td>
                    <td class="px-4 py-3"><span class="px-2 py-1 rounded text-xs ${u.status === 'active' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">${u.status === 'active' ? 'Ativo' : 'Inativo'}</span></td>
                    <td class="px-4 py-3">
                        ${u.role !== 'ADMIN' && u.role !== 'CEO' ? `<button onclick="deleteUser('${u.id}')" class="text-red-600 hover:text-red-800 text-sm" title="Excluir">üóëÔ∏è</button>` : '-'}
                    </td>
                </tr>
            `).join('');
        }

        function approveUser(id) {
            const user = DB.pendingUsers.find(u => u.id == id);
            if (!user) return;
            
            DB.users.push({
                id: user.id, name: user.name, email: user.email, password: 'user123',
                role: user.role, status: 'active', departamento: user.departamento,
                accesses: getDefaultAccess(user.role), createdAt: new Date().toISOString()
            });
            DB.pendingUsers = DB.pendingUsers.filter(u => u.id != id);
            
            DB.save('users');
            DB.save('pendingUsers');
            loadUsuarios();
            showToast('Usu√°rio aprovado!');
        }

        function rejectUser(id) {
            DB.pendingUsers = DB.pendingUsers.filter(u => u.id != id);
            DB.save('pendingUsers');
            loadUsuarios();
            showToast('Solicita√ß√£o rejeitada');
        }

        function deleteUser(id) {
            if (confirm('Tem certeza que deseja excluir este usu√°rio?')) {
                DB.users = DB.users.filter(u => u.id != id);
                DB.save('users');
                loadUsuarios();
                showToast('Usu√°rio exclu√≠do!');
            }
        }

        function getDefaultAccess(role) {
            const accessMap = {
                'CEO': ['dashboard', 'os', 'clientes', 'fornecedores', 'produtos', 'producao', 'estoque', 'vendas', 'compras', 'financeiro', 'usuarios', 'empresa', 'backup', 'relatorios'],
                'ADMIN': ['dashboard', 'os', 'clientes', 'fornecedores', 'produtos', 'producao', 'estoque', 'vendas', 'compras', 'financeiro', 'usuarios', 'empresa', 'backup', 'relatorios'],
                'VENDEDOR': ['dashboard', 'os', 'clientes', 'produtos', 'vendas'],
                'COMPRADOR': ['dashboard', 'fornecedores', 'compras', 'estoque'],
                'PRODUCAO': ['dashboard', 'producao', 'estoque'],
                'CORTADOR': ['producao', 'estoque'],
                'COSTUREIRA': ['producao'],
                'EMBALADOR': ['producao', 'estoque'],
                'TRANSPORTADOR': ['producao'],
                'CONTADOR': ['dashboard', 'financeiro', 'vendas', 'compras', 'relatorios'],
                'DESIGNER': ['dashboard', 'produtos', 'relatorios', 'backup']
            };
            return accessMap[role] || ['dashboard'];
        }

        // ========== EMPRESA (ADMIN) ==========
        function loadEmpresa() {
            document.getElementById('empRazao').value = DB.empresa.razao || '';
            document.getElementById('empNome').value = DB.empresa.nome || '';
            document.getElementById('empAbrev').value = DB.empresa.abrev || '';
            document.getElementById('empCNPJ').value = DB.empresa.cnpj || '';
            document.getElementById('empIE').value = DB.empresa.ie || '';
            document.getElementById('empIM').value = DB.empresa.im || '';
            document.getElementById('empEndereco').value = DB.empresa.endereco || '';
            document.getElementById('empCEP').value = DB.empresa.cep || '';
            document.getElementById('empCidade').value = DB.empresa.cidade || '';
            document.getElementById('empPais').value = DB.empresa.pais || 'Brasil';
            document.getElementById('empTelefone').value = DB.empresa.telefone || '';
            document.getElementById('empCelular').value = DB.empresa.celular || '';
            document.getElementById('empEmail').value = DB.empresa.email || '';
            document.getElementById('empSite').value = DB.empresa.site || '';
            document.getElementById('empResponsavel').value = DB.empresa.responsavel || '';
            document.getElementById('empRespCPF').value = DB.empresa.respCPF || '';
            document.getElementById('empRespCargo').value = DB.empresa.respCargo || '';
            
            const adminUser = DB.users.find(u => u.role === 'ADMIN') || DB.users.find(u => u.role === 'CEO');
            if (adminUser) {
                document.getElementById('adminEmail').value = adminUser.email || '';
                document.getElementById('adminNome').value = adminUser.name || '';
                document.getElementById('adminCargo').value = adminUser.cargo || '';
                document.getElementById('adminTelefone').value = adminUser.telefone || '';
                document.getElementById('adminCriado').textContent = adminUser.createdAt ? formatDate(adminUser.createdAt) : '-';
                document.getElementById('adminUltimoAcesso').textContent = adminUser.lastAccess ? formatDateTime(adminUser.lastAccess) : '-';
                document.getElementById('adminTotalAcessos').textContent = adminUser.accessCount || 0;
            }
            
            updateLogoDisplay();
            renderBancos();
            
            const dados = DB.dadosAdicionais.empresa || {};
            document.getElementById('divCNAE').value = dados.cnae || '';
            document.getElementById('divNIRE').value = dados.nire || '';
            document.getElementById('divIndicadorIE').value = dados.indicadorIE || '';
            document.getElementById('divRegime').value = dados.regime || '';
            document.getElementById('divFacebook').value = dados.facebook || '';
            document.getElementById('divInstagram').value = dados.instagram || '';
            document.getElementById('divLinkedin').value = dados.linkedin || '';
            document.getElementById('divRodapeOrcamento').value = dados.rodapeOrcamento || '';
            document.getElementById('divObsOS').value = dados.obsOS || '';
        }

        function updateLogoDisplay() {
            const logoContainer = document.getElementById('logoPreviewContainer');
            const logoInfo = document.getElementById('logoInfo');
            
            if (DB.empresa.logo) {
                logoContainer.innerHTML = `<img src="${DB.empresa.logo}" alt="Logotipo" class="w-full h-full object-contain rounded-lg p-2">`;
                logoInfo.classList.remove('hidden');
            } else {
                logoContainer.innerHTML = `<span class="text-6xl">üè•</span><p class="text-sm text-gray-500 mt-2">Sem logotipo</p>`;
                logoInfo.classList.add('hidden');
            }
        }

        function renderBancos() {
            const list = document.getElementById('bancosList');
            list.innerHTML = (DB.empresa.bancos || []).map((b, i) => `
                <div class="flex flex-col md:flex-row justify-between items-center gap-3 p-4 bg-gray-50 rounded-lg border">
                    <div class="flex-1 text-center md:text-left">
                        <div class="flex items-center gap-2 flex-wrap justify-center md:justify-start">
                            <span class="font-semibold text-gray-800">${b.nome}</span>
                            ${b.codigo ? `<span class="text-xs bg-gray-200 px-2 py-0.5 rounded">${b.codigo}</span>` : ''}
                            <span class="text-xs px-2 py-0.5 rounded ${b.status === 'ativa' ? 'bg-green-100 text-green-700' : 'bg-gray-200 text-gray-600'}">${b.status || 'ativa'}</span>
                        </div>
                        <div class="text-sm text-gray-600 mt-1">
                            <span>Ag√™ncia: ${b.agencia}</span> | <span>Conta: ${b.conta}</span>
                            ${b.tipo ? `<span> (${b.tipo})</span>` : ''}
                        </div>
                        ${b.pix ? `<div class="text-xs text-gray-500 mt-1">PIX: ${b.pix}</div>` : ''}
                        ${b.obs ? `<div class="text-xs text-cyan-600 mt-1">${b.obs}</div>` : ''}
                    </div>
                    <div class="flex gap-2">
                        <button onclick="editBanco(${i})" class="text-blue-600 hover:text-blue-800 text-sm px-2" title="Editar">‚úèÔ∏è</button>
                        <button onclick="removeBanco(${i})" class="text-red-600 hover:text-red-800 text-sm px-2" title="Excluir">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('') || '<p class="text-sm text-gray-500 text-center py-4">Nenhuma conta banc√°ria cadastrada</p>';
        }

        function editBanco(index) {
            const b = DB.empresa.bancos[index];
            if (b) {
                document.getElementById('bancoNome').value = b.nome || '';
                document.getElementById('bancoCodigo').value = b.codigo || '';
                document.getElementById('bancoAgencia').value = b.agencia || '';
                document.getElementById('bancoConta').value = b.conta || '';
                document.getElementById('bancoTipo').value = b.tipo || 'corrente';
                document.getElementById('bancoOperacao').value = b.operacao || '';
                document.getElementById('bancoPix').value = b.pix || '';
                document.getElementById('bancoObs').value = b.obs || '';
                document.getElementById('bancoStatus').value = b.status || 'ativa';
                DB.empresa.bancos.splice(index, 1);
                DB.save('empresa');
                renderBancos();
                showToast('Edite a conta e clique em Adicionar novamente');
            }
        }

        document.getElementById('empresaForm').addEventListener('submit', (e) => {
            e.preventDefault();
            Object.assign(DB.empresa, {
                razao: document.getElementById('empRazao').value,
                nome: document.getElementById('empNome').value,
                abrev: document.getElementById('empAbrev').value,
                cnpj: document.getElementById('empCNPJ').value,
                ie: document.getElementById('empIE').value,
                im: document.getElementById('empIM').value,
                endereco: document.getElementById('empEndereco').value,
                cep: document.getElementById('empCEP').value,
                cidade: document.getElementById('empCidade').value,
                pais: document.getElementById('empPais').value,
                telefone: document.getElementById('empTelefone').value,
                celular: document.getElementById('empCelular').value,
                email: document.getElementById('empEmail').value,
                site: document.getElementById('empSite').value,
                responsavel: document.getElementById('empResponsavel').value,
                respCPF: document.getElementById('empRespCPF').value,
                respCargo: document.getElementById('empRespCargo').value
            });
            
            DB.save('empresa');
            showToast('‚úÖ Dados da empresa salvos com sucesso!');
        });

        document.getElementById('adminForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const email = document.getElementById('adminEmail').value;
            const nome = document.getElementById('adminNome').value;
            const cargo = document.getElementById('adminCargo').value;
            const telefone = document.getElementById('adminTelefone').value;
            const senha = document.getElementById('adminSenha').value;
            const senhaConfirm = document.getElementById('adminSenhaConfirm').value;
            
            if (senha && senha !== senhaConfirm) {
                showToast('‚ùå As senhas n√£o coincidem!');
                return;
            }
            
            const adminIndex = DB.users.findIndex(u => u.role === 'ADMIN' || u.role === 'CEO');
            if (adminIndex >= 0) {
                DB.users[adminIndex].email = email;
                DB.users[adminIndex].name = nome;
                DB.users[adminIndex].cargo = cargo;
                DB.users[adminIndex].telefone = telefone;
                DB.users[adminIndex].lastAccess = new Date().toISOString();
                
                if (senha) {
                    DB.users[adminIndex].password = senha;
                }
                
                if (currentUser && (currentUser.role === 'ADMIN' || currentUser.role === 'CEO')) {
                    currentUser.email = email;
                    currentUser.name = nome;
                    localStorage.setItem('medsucare_currentUser', JSON.stringify(currentUser));
                }
                
                DB.save('users');
                showToast('‚úÖ Administrador atualizado com sucesso!');
                
                document.getElementById('adminSenha').value = '';
                document.getElementById('adminSenhaConfirm').value = '';
                document.getElementById('adminUltimoAcesso').textContent = formatDateTime(new Date().toISOString());
            }
        });

        document.getElementById('bancoForm').addEventListener('submit', (e) => {
            e.preventDefault();
            if (!DB.empresa.bancos) DB.empresa.bancos = [];
            
            DB.empresa.bancos.push({
                nome: document.getElementById('bancoNome').value,
                codigo: document.getElementById('bancoCodigo').value,
                agencia: document.getElementById('bancoAgencia').value,
                conta: document.getElementById('bancoConta').value,
                tipo: document.getElementById('bancoTipo').value,
                operacao: document.getElementById('bancoOperacao').value,
                pix: document.getElementById('bancoPix').value,
                obs: document.getElementById('bancoObs').value,
                status: document.getElementById('bancoStatus').value
            });
            
            DB.save('empresa');
            e.target.reset();
            renderBancos();
            showToast('‚úÖ Conta banc√°ria adicionada!');
        });

        function removeBanco(index) {
            if (confirm('Tem certeza que deseja excluir esta conta banc√°ria?')) {
                DB.empresa.bancos.splice(index, 1);
                DB.save('empresa');
                renderBancos();
                showToast('Conta removida!');
            }
        }

        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 2 * 1024 * 1024) {
                    showToast('‚ùå Arquivo muito grande! M√°x 2MB');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    DB.empresa.logo = e.target.result;
                    DB.save('empresa');
                    updateLogoDisplay();
                    showToast('‚úÖ Logotipo carregado com sucesso!');
                };
                reader.readAsDataURL(file);
            }
        }

        function removeLogo() {
            if (confirm('Tem certeza que deseja remover o logotipo?')) {
                DB.empresa.logo = null;
                DB.save('empresa');
                updateLogoDisplay();
                showToast('Logotipo removido!');
            }
        }

        document.getElementById('diversosForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const dados = {
                cnae: document.getElementById('divCNAE').value,
                nire: document.getElementById('divNIRE').value,
                indicadorIE: document.getElementById('divIndicadorIE').value,
                regime: document.getElementById('divRegime').value,
                facebook: document.getElementById('divFacebook').value,
                instagram: document.getElementById('divInstagram').value,
                linkedin: document.getElementById('divLinkedin').value,
                rodapeOrcamento: document.getElementById('divRodapeOrcamento').value,
                obsOS: document.getElementById('divObsOS').value
            };
            
            DB.dadosAdicionais.empresa = dados;
            DB.save('dados_adicionais');
            showToast('‚úÖ Configura√ß√µes salvas com sucesso!');
        });

        // ========== BACKUP / SINCRONIZA√á√ÉO ==========
        function loadBackup() {
            document.getElementById('statRegistrosOS').textContent = DB.os.length;
            document.getElementById('statRegistrosClientes').textContent = DB.clientes.length;
            document.getElementById('statRegistrosProdutos').textContent = DB.produtos.length;
            document.getElementById('statRegistrosFornecedores').textContent = DB.fornecedores.length;
            document.getElementById('statRegistrosProducao').textContent = DB.producao.length;
            document.getElementById('statRegistrosCompras').textContent = DB.compras.length;
            document.getElementById('lastSync').textContent = formatDateTime(new Date().toISOString());
        }

        // ========== EXPORTA√á√ÉO CSV ==========
        function exportToCSV(data, filename) {
            if (!data || data.length === 0) return null;
            
            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join(';'),
                ...data.map(row => headers.map(h => {
                    let val = row[h];
                    if (typeof val === 'object') val = JSON.stringify(val).replace(/"/g, '""');
                    if (val === null || val === undefined) val = '';
                    return `"${val}"`;
                }).join(';'))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            
            return true;
        }

        function exportAllToCSV() {
            showToast('üì• Baixando arquivos CSV...');
            
            setTimeout(() => {
                exportToCSV(DB.users, 'CSV_Usuarios.csv');
                setTimeout(() => {
                    exportToCSV(DB.clientes, 'CSV_Clientes.csv');
                    setTimeout(() => {
                        exportToCSV(DB.fornecedores, 'CSV_Fornecedores.csv');
                        setTimeout(() => {
                            exportToCSV(DB.produtos, 'CSV_Produtos.csv');
                            setTimeout(() => {
                                exportToCSV(DB.os.map(o => ({
                                    numero: o.numero, data: o.data, clienteId: o.clienteId, clienteNome: o.clienteNome,
                                    status: o.status, produtos: JSON.stringify(o.produtos), total: o.total,
                                    pagamento: o.pagamento, prazo: o.prazo, obs: o.obs
                                })), 'CSV_OS.csv');
                                setTimeout(() => {
                                    exportToCSV(DB.producao, 'CSV_Producao.csv');
                                    setTimeout(() => {
                                        exportToCSV(DB.estoque, 'CSV_Estoque.csv');
                                        setTimeout(() => {
                                            exportToCSV(DB.compras, 'CSV_Compras.csv');
                                            setTimeout(() => {
                                                exportToCSV([DB.empresa], 'CSV_Empresa.csv');
                                                showToast('‚úÖ Todos os arquivos CSV baixados!');
                                            }, 100);
                                        }, 100);
                                    }, 100);
                                }, 100);
                            }, 100);
                        }, 100);
                    }, 100);
                }, 100);
            }, 100);
        }

        function exportSingleCSV(type) {
            showToast(`üì• Baixando CSV_${type}...`);
            
            switch(type) {
                case 'usuarios': exportToCSV(DB.users, 'CSV_Usuarios.csv'); break;
                case 'clientes': exportToCSV(DB.clientes, 'CSV_Clientes.csv'); break;
                case 'fornecedores': exportToCSV(DB.fornecedores, 'CSV_Fornecedores.csv'); break;
                case 'produtos': exportToCSV(DB.produtos, 'CSV_Produtos.csv'); break;
                case 'os': 
                    exportToCSV(DB.os.map(o => ({
                        numero: o.numero, data: o.data, clienteId: o.clienteId, clienteNome: o.clienteNome,
                        status: o.status, produtos: JSON.stringify(o.produtos), total: o.total,
                        pagamento: o.pagamento, prazo: o.prazo, obs: o.obs
                    })), 'CSV_OS.csv'); 
                    break;
                case 'producao': exportToCSV(DB.producao, 'CSV_Producao.csv'); break;
                case 'estoque': exportToCSV(DB.estoque, 'CSV_Estoque.csv'); break;
                case 'compras': exportToCSV(DB.compras, 'CSV_Compras.csv'); break;
                case 'empresa': exportToCSV([DB.empresa], 'CSV_Empresa.csv'); break;
            }
            showToast(`‚úÖ CSV_${type} baixado!`);
        }

        // ========== IMPORTA√á√ÉO CSV ==========
        function parseCSV(text) {
            const lines = text.split('\n').filter(l => l.trim());
            if (lines.length < 2) return [];
            
            const headers = lines[0].split(';').map(h => h.replace(/"/g, '').trim());
            
            return lines.slice(1).map(line => {
                const values = line.split(';').map(v => v.replace(/^"|"$/g, '').trim());
                const obj = {};
                headers.forEach((h, i) => {
                    let val = values[i];
                    try {
                        if (val.startsWith('{') || val.startsWith('[')) {
                            val = JSON.parse(val);
                        }
                    } catch(e) {}
                    obj[h] = val;
                });
                return obj;
            });
        }

        function handleCSVImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const content = e.target.result;
                const data = parseCSV(content);
                
                const filename = file.name.toLowerCase();
                
                if (filename.includes('usuarios')) {
                    DB.users = data;
                    document.getElementById('import-usuarios').checked = true;
                } else if (filename.includes('clientes')) {
                    DB.clientes = data;
                    document.getElementById('import-clientes').checked = true;
                } else if (filename.includes('fornecedores')) {
                    DB.fornecedores = data;
                    document.getElementById('import-fornecedores').checked = true;
                } else if (filename.includes('produtos')) {
                    DB.produtos = data;
                    document.getElementById('import-produtos').checked = true;
                } else if (filename.includes('_os') || filename.includes('os')) {
                    DB.os = data;
                    document.getElementById('import-os').checked = true;
                } else if (filename.includes('producao')) {
                    DB.producao = data;
                    document.getElementById('import-producao').checked = true;
                } else if (filename.includes('estoque')) {
                    DB.estoque = data;
                    document.getElementById('import-estoque').checked = true;
                } else if (filename.includes('compras')) {
                    DB.compras = data;
                    document.getElementById('import-compras').checked = true;
                } else if (filename.includes('empresa')) {
                    if (data[0]) Object.assign(DB.empresa, data[0]);
                    document.getElementById('import-empresa').checked = true;
                }
                
                showToast(`‚úÖ ${file.name} importado! Marque para carregar no sistema.`);
            };
            reader.readAsText(file);
        }

        function importSelectedCSV() {
            let count = 0;
            
            if (document.getElementById('import-usuarios').checked) { DB.save('users'); count++; }
            if (document.getElementById('import-clientes').checked) { DB.save('clientes'); count++; }
            if (document.getElementById('import-fornecedores').checked) { DB.save('fornecedores'); count++; }
            if (document.getElementById('import-produtos').checked) { DB.save('produtos'); count++; }
            if (document.getElementById('import-os').checked) { DB.save('os'); count++; }
            if (document.getElementById('import-producao').checked) { DB.save('producao'); count++; }
            if (document.getElementById('import-estoque').checked) { DB.save('estoque'); count++; }
            if (document.getElementById('import-compras').checked) { DB.save('compras'); count++; }
            if (document.getElementById('import-empresa').checked) { DB.save('empresa'); count++; }
            
            if (count > 0) {
                DB.loadAll();
                loadBackup();
                showToast(`‚úÖ ${count} arquivo(s) sincronizado(s) com sucesso!`);
                
                // Limpar checkboxes
                document.querySelectorAll('#backup input[type="checkbox"]').forEach(cb => cb.checked = false);
                document.getElementById('csvFileInput').value = '';
            } else {
                showToast('‚ö†Ô∏è Nenhum arquivo selecionado para importar');
            }
        }

        // ========== GERA√á√ÉO DE PDF ==========
        function generatePDF(osNumero) {
            const os = DB.os.find(o => o.numero === osNumero);
            if (!os) return;
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            if (DB.empresa.logo) {
                try { doc.addImage(DB.empresa.logo, 'PNG', 20, 10, 30, 30); } catch(e) {}
            }
            
            doc.setFontSize(20);
            doc.text('ORDEM DE SERVI√áO', 105, 25, { align: 'center' });
            doc.setFontSize(10);
            doc.text(DB.empresa.nome || 'MedSuCare', 105, 32, { align: 'center' });
            doc.setFontSize(9);
            
            let y = 45;
            doc.text(`OS: ${os.numero}`, 20, y);
            doc.text(`Data: ${formatDate(os.data)}`, 150, y);
            y += 7;
            doc.text(`Status: ${os.status}`, 20, y);
            
            doc.line(20, y + 3, 190, y + 3);
            y += 12;
            
            doc.setFontSize(11);
            doc.setFont(undefined, 'bold');
            doc.text('CLIENTE', 20, y);
            doc.setFont(undefined, 'normal');
            y += 7;
            doc.setFontSize(10);
            doc.text(`Nome: ${os.clienteNome}`, 20, y);
            const cliente = DB.clientes.find(c => c.id == os.clienteId);
            if (cliente) {
                y += 5;
                doc.text(`CNPJ: ${cliente.cnpj || ''}`, 20, y);
                y += 5;
                doc.text(`Endere√ßo: ${cliente.endereco || ''} - ${cliente.cidade || ''}`, 20, y);
                y += 5;
                doc.text(`Respons√°vel: ${cliente.responsavel || ''} - Tel: ${cliente.contatoResp || ''}`, 20, y);
            }
            
            y += 15;
            doc.setFontSize(11);
            doc.setFont(undefined, 'bold');
            doc.text('PRODUTOS/SERVI√áOS', 20, y);
            y += 7;
            doc.setFontSize(9);
            
            const produtos = (os.produtos || []).map(p => {
                const prod = DB.produtos.find(pr => pr.id == p.produtoId);
                return [prod?.nome || 'Produto', p.qtd, formatCurrency(p.valor), formatCurrency(p.qtd * p.valor)];
            });
            
            doc.autoTable({
                startY: y,
                head: [['Produto', 'Qtd', 'Valor Unit.', 'Total']],
                body: produtos,
                theme: 'striped',
                headStyles: { fillColor: [6, 182, 212] }
            });
            
            y = doc.lastAutoTable.finalY + 10;
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text(`TOTAL: ${formatCurrency(os.total)}`, 150, y);
            
            y += 15;
            doc.setFont(undefined, 'normal');
            doc.setFontSize(10);
            doc.text(`Pagamento: ${os.pagamento || 'N√£o informado'}`, 20, y);
            y += 6;
            doc.text(`Prazo: ${os.prazo ? formatDate(os.prazo) : 'N√£o informado'}`, 20, y);
            
            doc.save(`OS_${os.numero}.pdf`);
            showToast('PDF gerado com sucesso!');
        }

        // ========== UTILIT√ÅRIOS ==========
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value || 0);
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleDateString('pt-BR');
        }

        function formatDateTime(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleString('pt-BR');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = message;
            toast.classList.remove('hidden', 'translate-y-full', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-full', 'opacity-0');
                setTimeout(() => toast.classList.add('hidden'), 300);
            }, 3000);
        }

        // ========== DADOS DE EXEMPLO ==========
        function createSampleData() {
            if (DB.produtos.length === 0) {
                DB.produtos = [
                    { id: 1, nome: 'Avental Descart√°vel TNT Polipropileno', codigo: 'AV-TNT-001', tipo: 'Pr√≥prio', composicao: '100% Polipropileno', gramatura: '30', tamanho: 'G', esteril: 'N√£o est√©ril', mangas: 'Curtas', punho: 'El√°stico', embalagem: 'Unit√°rio', cor: 'Branco', valor: 5.50, createdAt: new Date().toISOString() },
                    { id: 2, nome: 'Capote Cir√∫rgico SMS Est√©ril', codigo: 'CP-SMS-001', tipo: 'Pr√≥prio', composicao: 'SMS', gramatura: '40', tamanho: '√önico', esteril: 'Est√©ril', mangas: 'Longas', punho: 'Sanfonado', embalagem: 'Grau cir√∫rgico', cor: 'Branco', valor: 25.00, createdAt: new Date().toISOString() },
                    { id: 3, nome: 'Avental EASY SUPRI', codigo: 'ES-EASY-001', tipo: 'Terceirizado', composicao: '100% Polipropileno', gramatura: '20', tamanho: 'G', esteril: 'N√£o est√©ril', mangas: 'Curtas', punho: 'El√°stico', embalagem: 'Pacote 10', cor: 'Azul', valor: 45.00, marca: 'EASY SUPRI', createdAt: new Date().toISOString() },
                    { id: 4, nome: 'Avental PROTMED Est√©ril', codigo: 'PM-PRO-001', tipo: 'Terceirizado', composicao: 'SMMS', gramatura: '35', tamanho: 'GG', esteril: 'Est√©ril', mangas: 'Longas', punho: 'Malha', embalagem: 'Unit√°rio', cor: 'Branco', valor: 18.00, marca: 'PROTMED', createdAt: new Date().toISOString() }
                ];
                DB.save('produtos');
            }
            
            if (DB.clientes.length === 0) {
                DB.clientes = [
                    { id: 1, nome: 'Hospital Central', fantasia: 'Hospital Central', cnpj: '00.000.000/0001-00', telefone: '(00) 0000-0000', email: 'compras@hospitalcentral.com.br', endereco: 'Av. Principal, 1000', cep: '00000-000', cidade: 'S√£o Paulo - SP', responsavel: 'Dr. Jo√£o Silva', contatoResp: '(00) 99999-9999', status: 'ativo', createdAt: new Date().toISOString() },
                    { id: 2, nome: 'Cl√≠nica M√©dica ABC', fantasia: 'Cl√≠nica ABC', cnpj: '00.000.000/0002-00', telefone: '(00) 0000-0001', email: 'adm@clinicabc.com.br', endereco: 'Rua das Flores, 500', cep: '00000-001', cidade: 'Rio de Janeiro - RJ', responsavel: 'Dra. Maria Santos', contatoResp: '(00) 99998-9998', status: 'ativo', createdAt: new Date().toISOString() }
                ];
                DB.save('clientes');
            }
            
            if (DB.fornecedores.length === 0) {
                DB.fornecedores = [
                    { id: 1, nome: 'TexTecnica - Tecidos T√©cnicos', cnpj: '00.000.000/0004-00', telefone: '(00) 0000-0003', email: 'vendas@textecnica.com.br', produtos: ['TNT Polipropileno', 'TNT SMS', 'TNT SMMS'], prazo: '15 dias', status: 'ativo' },
                    { id: 2, nome: 'El√°sticos Brasil', cnpj: '00.000.000/0005-00', telefone: '(00) 0000-0004', email: 'contato@elasticosbrasil.com.br', produtos: ['El√°stico'], prazo: '7 dias', status: 'ativo' }
                ];
                DB.save('fornecedores');
            }
            
            if (DB.estoque.length === 0) {
                DB.estoque = [
                    { id: 1, item: 'TNT Polipropileno 30g', tipo: 'Tecido', quantidade: 1500, unidade: 'm', min: 500, max: 3000 },
                    { id: 2, item: 'TNT SMS 40g', tipo: 'Tecido', quantidade: 800, unidade: 'm', min: 300, max: 2000 },
                    { id: 3, item: 'El√°stico 20mm', tipo: 'Aviamento', quantidade: 5000, unidade: 'm', min: 1000, max: 10000 },
                    { id: 4, item: 'Linha Poliamida', tipo: 'Aviamento', quantidade: 200, unidade: 'un', min: 50, max: 500 },
                    { id: 5, item: 'Embalagem Pacote 5', tipo: 'Embalagem', quantidade: 1000, unidade: 'un', min: 200, max: 3000 },
                    { id: 6, item: 'Etiqueta Branca', tipo: 'Etiqueta', quantidade: 5000, unidade: 'un', min: 1000, max: 10000 }
                ];
                DB.save('estoque');
            }
        }

        // ========== INICIALIZA√á√ÉO ==========
        document.addEventListener('DOMContentLoaded', () => {
            const savedUser = localStorage.getItem('medsucare_currentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    initApp();
                } catch (e) {
                    showLogin();
                }
            } else {
                showLogin();
            }
            
            createSampleData();
            DB.loadAll();
        });
    </script>
</body>
</html>